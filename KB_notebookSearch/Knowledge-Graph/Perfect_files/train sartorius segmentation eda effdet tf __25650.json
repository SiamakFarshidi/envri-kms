{"name": "train sartorius segmentation eda effdet tf ", "full_name": " h2 Cell Instance Segmentation Challenge h1 TABLE OF CONTENTS h3 0 xa0 xa0 xa0 xa0IMPORTS h3 1 xa0 xa0 xa0 xa0BACKGROUND INFORMATION h3 2 xa0 xa0 xa0 xa0SETUP h3 3 xa0 xa0 xa0 xa0HELPER FUNCTIONS h3 4 xa0 xa0 xa0 xa0DATASET CREATION AND EXPLORATION h3 5 xa0 xa0 xa0 xa0MODELLING h1 0 xa0 xa0IMPORTS xa0 xa0 xa0 xa0 h1 1 xa0 xa0BACKGROUND INFORMATION xa0 xa0 xa0 xa0 h3 1 1 BASIC COMPETITION INFORMATION h3 1 2 COMPETITION EVALUATION h3 1 3 DATASET OVERVIEW h1 2 xa0 xa0SETUP xa0 xa0 xa0 xa0 h3 2 1 ACCELERATOR DETECTION h1 The name you gave to the TPU to use h1 or you can also specify the grpc path directly h1 TPU WORKER grpc xxx xxx xxx xxx 8470 h1 The zone you chose when you created the TPU to use on GCP h1 The name of the GCP project where you created the TPU to use on GCP h3 2 2 COMPETITION DATA ACCESS h3 2 3 LEVERAGING XLA OPTIMIZATIONS h3 2 4 BASIC DATA DEFINITIONS INITIALIZATIONS h1 n 3 xa0 xa0HELPER FUNCTION CLASSES xa0 xa0 xa0 xa0 n h1 n 4 xa0 xa0DATASET CREATION AND EXPLORATION xa0 xa0 xa0 xa0 n h3 4 0 UPDATE THE TRAIN DATAFRAME h3 4 1 VISUALIZE THE TRAIN DATA h3 4 2 INVESTIGATE THE TRAIN DATAFRAME h3 4 3 VISUALIZE INVESTIGATE THE LIVECell DATA h3 4 4 VISUALIZE INVESTIGATE THE SEMI SUPERVISED TRAIN DATA h3 4 5 VISUALIZE INVESTIGATE INDIVIDUAL CELLS h3 4 6 ADD BBOXES TO DATAFRAME h3 4 7 STATS REGARDING BOUNDING BOXES h1 n 5 xa0 xa0MODELLING xa0 xa0 xa0 xa0 n h3 5 0 EFFICIENTDET UTILITY FUNCTIONS CONSTANTS h3 5 1 LOAD EFFICIENTDET MODEL AND INITIALIZE h3 5 2 CREATE A DATASET WITH THE CORRECT STRUCTURE h3 5 3 INSTANIATE OUR DATALOADER h3 5 4 CREATE MODEL AND LOAD PRETRAINED WEIGHTS h3 5 5 TRAIN THE MODEL h3 5 6 VALIDATE THE MODEL IS LEARNING h3 5 7 IOU ON VALIDATION DATASET h3 5 8 CONFUSION MATRIX FOR VALIDATION DATASET h1 n 5 xa0 xa0SUBMISSION xa0 xa0 xa0 xa0 n ", "stargazers_count": 0, "forks_count": 0, "description": "csv a sample submission file in the correct format train train images in PNG format test test images in PNG format. They re a magnet and dynamic platform for pioneers and leading experts in the field. A false positive indicates a predicted object had no associated ground truth object. They bring creative minds together for a common goal technological breakthroughs that lead to better health for more people. Sartorius is a partner of the life science research and the biopharmaceutical industry. 2 INVESTIGATE THE TRAIN DATAFRAME 4. function calls FIX THE TRAIN DATAFRAME GROUP THE RLEs TOGETHER Capture Image Path As Well This is required for plotting so that the smaller distributions get plotted on top ref https www. 5 VISUALIZE INVESTIGATE INDIVIDUAL CELLS Let s review a single image and then look into the cells that make up that image4. Each replica is essentially a copy of the training graph that is run on each core and trains a mini batch containing 1 8th of the overall batch size Google Cloud Dataset path to training and validation images Local path to training and validation images enable XLA optmizations 10 speedup when using tf. None of this metadata is provided for the test set. In this competition you ll detect and delineate distinct objects of interest in biological images depicting neuronal cell types commonly used in the study of neurological disorders. 3 LEVERAGING XLA OPTIMIZATIONS XLA Accelerated Linear Algebra is a domain specific compiler for linear algebra that can accelerate TensorFlow models with potentially no source code changes. 4 v4 beta or v4 official if the length of the contours tuple is 3 then we are using either OpenCV v3 v4 pre or v4 alpha otherwise OpenCV has changed their cv2. It also checks that no two predicted masks for the same image are overlapping. 1 ACCELERATOR DETECTION In order to use TPU we use TPUClusterResolver for the initialization which is necessary to connect to the remote cluster and initialize cloud TPUs. 0 EFFICIENTDET UTILITY FUNCTIONS CONSTANTS 5. 95 In other words at a threshold of 0. This could be because neuronal cells have a very unique irregular and concave morphology associated with them making them challenging to segment with commonly used mask heads. nbsp TIPS If you have multiple datasets attached to the notebook you should pass the name of a specific dataset to the get_gcs_path function. py if the length the contours tuple returned by cv2. Create a dictionary mapping the feature name to the tf. 95 with a step size of 0. 1 VISUALIZE THE TRAIN DATA Let s create a function to take a single example row of the dataframe and plot the resulting informationQUICK DOUBLECHECK ON RLE DECODE FUNCTION https www. LIVECell is the predecessor dataset to this competition. However on G oogle C ompute E ngine GCE you will need to do the following python The name you gave to the TPU to useTPU_WORKER my tpu name or you can also specify the grpc path directly TPU_WORKER grpc xxx. More specifically you ll use phase contrast microscopy images to train and test your model for instance segmentation of neuronal cells. 6 ADD BBOXES TO DATAFRAME Let s iterate over the images and add the bounding box coordinates to the dataframe in order matching the RLE We also add the 0 1 normalized version of the bboxes to the dataframe for later training purposes4. 7 STATS REGARDING BOUNDING BOXES 5 nbsp nbsp MODELLING nbsp nbsp nbsp nbsp 10514 EfficientDET for Object Detection Classification and Segmentation5. The jit_compile API has must compile semantics i. IS THIS A CODE COMPETITION YES1. xxx 8470 The zone you chose when you created the TPU to use on GCP. Example compatible data type. The competition format requires a space delimited list of pairs. This can be found on the GCP project dashboard page. If successful you ll help further research in neurobiology thanks to the collection of robust quantitative data. Let s go over two important points1. TPUClusterResolver tpu TPU_WORKER zone ZONE project PROJECT nbsp WARNING Although the Tensorflow documentation says it is the project name that should be provided for the argument project it is actually the Project ID that you should provide. Therefore for efficient utilization of Cloud TPU a program should make use of each of the EIGHT 4x2 cores. Yield the default distribution strategy in Tensorflow Works on CPU and single GPU. 8 CONFUSION MATRIX FOR VALIDATION DATASET TRAINING DATA FIRST BATCH VALIDATION DATA FIRST BATCH 5 nbsp nbsp SUBMISSION nbsp nbsp nbsp nbsp 10514 WIP Try to skip and disable so we can submit w o internet pip install q upgrade tensorflow_datasets pip install q neural structured learning Machine Learning and Data Science Imports Built In Imports Visualization Imports SET LIBRARY DIRECTORY To give access to automl files EfficientDET Module Imports Detect hardware return appropriate distribution strategy TPU detection. The hidden test set is roughly 240 images. One accepted method is to review neuronal cells via light microscopy which is both accessible and non invasive. ZONE us east1 b The name of the GCP project where you created the TPU to use on GCP. The pixels are one indexedand numbered from top to bottom then left to right 1 is pixel 1 1 2 is pixel 2 1 etc. com namgalielei which reshape is used in rle Reshape from top bottom first ref. However it is hard to quantify how well these deadly disorders respond to treatment. com paulorzp run length encode and decode modified from https www. Current solutions have limited accuracy for neuronal cells in particular. In internal studies to develop cell instance segmentation models the neuroblastoma cell line SH SY5Y consistently exhibits the lowest precision scores out of eight different cancer cell types tested. Unfortunately segmenting individual neuronal cells in microscopic images can be challenging and time intensive. The metric checks that the pairs are sorted positive and the decoded pixel values are not duplicated. 4 VISUALIZE INVESTIGATE THE SEMI SUPERVISED TRAIN DATA Let s review the semi supervised training data4. 1 3 implies starting at pixel 1 and running a total of 3 pixels 1 2 3. LIVECell_dataset_2021 A mirror of the data from the LIVECell dataset. findContours return signature yet again and I have no idea WTH is going on return the actual contours array Get contour s There should be only one Get extreme coordinates Early Exit Else Return images Flip black white. When a TensorFlow program is run all of the operations are executed individually by the TensorFlow executor. Each TensorFlow operation has a precompiled GPU TPU kernel implementation that the executor dispatches to. InvalidArgumentError exception is thrown nbsp REFERENCE XLA Optimizing Compiler for Machine Learning2. then we instantiate a dataloader 5. Each row in your submission represents a single predicted nucleus segmentation for the given ImageId. No parameters necessary if TPU_NAME environment variable is set. 1 BASIC COMPETITION INFORMATION PRIMARY TASK DESCRIPTIONThis is a placeholder copy paste from the OVERVIEW DESCRIPTION page of the Kaggle competitionNeurological disorders including neurodegenerative diseases such as Alzheimer s and brain tumors are a leading cause of death and disability across the globe. 4 BASIC DATA DEFINITIONS INITIALIZATIONS 3 nbsp nbsp HELPER FUNCTION CLASSES nbsp nbsp nbsp nbsp 10514 4 nbsp nbsp DATASET CREATION AND EXPLORATION nbsp nbsp nbsp nbsp 10514 4. Make dataframe iterable Create folder Create tfrecords This makes the tfrecord TRAIN VAL VAL Compute intersection between all objects Compute areas needed for finding the union between all objects Compute union exclude background Correct objects Missed objects Extra objects We want. On Kaggle this is always the case. nbsp WARNING XLA can not currently compile functions where dimensions are not inferrable that is if it s not possible to infer the dimensions of all tensors without running the entire computation nbsp NOTE XLA compilation is only applied to code that is compiled into a graph in TF2 that s only a code inside tf. Only a few test set images are available for download the remainder can only be accessed by your notebooks when you submit. Researchers may be able to use this to more easily measure the effects of disease and treatment conditions on neuronal cells. Submission files may take several minutes to process due to the size. so disablled for now5. 3 DATASET OVERVIEW GENERAL INFORMATIONIn this competition we are segmenting neuronal cells in images. The IoU of a proposed set of object pixels and a set of true object pixels is calculated as IoU A B frac A cap B A cup B The metric sweeps over a range of IoU thresholds at each point calculating an average precision value. 5 a predicted object is considered a hit if its intersection over union with a ground truth object is greater than 0. For example 1 3 10 5 implies pixels 1 2 3 10 11 12 13 14 are to be included in the mask. white black Aggregate under training Capture Image Path As Well Takes about 1 minute CORT ASTRO SHSY5Y Plot Background 3 Cell Types Background Foreground Cells Whether or not we train from scratch or load Change how input preprocessing is done BytesList won t unpack a string from an EagerTensor. 3 VISUALIZE INVESTIGATE THE LIVECell DATA Let s review the LIVECell dataset4. The number of images is small but the number of annotated objects is quite high. 0 UPDATE THE TRAIN DATAFRAME We need to change a few things with the train dataframe Aggregate under id Add in certain columns4. 2 nbsp nbsp SETUP nbsp nbsp nbsp nbsp 10514 2. findContours is 2 then we are using either OpenCV v2. The average precision of a single image is then calculated as the mean of the above precision values at each IoU threshold frac 1 thresholds sum_t frac TP t TP t FP t FN t Lastly the score returned by the competition metric is the mean taken over the individual average precisions of each image in the test dataset. Please see a previous version of this notebook Version 33 https www. Instead of submitting an exhaustive list of indices for your segmentation you will submit pairs of values that contain a start position and a run length. They empower scientists and engineers to simplify and accelerate progress in life science and bioprocessing enabling the development of new and better therapies and more affordable medicine. 2 COMPETITION DATA ACCESS TPUs read data must be read directly from G oogle C loud S torage GCS. com namgalielei which reshape is used in rle4. com PyImageSearch imutils blob master imutils convenience. Cell Instance Segmentation ChallengeCREATED BY DARIEN SCHETTLER nbsp WARNING THIS IS A WORK IN PROGRESS nbsp IF YOU FORK THIS OR FIND THIS HELPFUL nbsp PLEASE UPVOTE This was a lot of work for me and while it may seem silly it makes me feel appreciated when others like my work. com inversion run length decoding quick start Split the string by space then convert it into a integer array Every even value is the start every odd value is the run length The image image is actually flattened since RLE is a 1D run The color here is actually just any integer you want Don t forget to change the image back to the original shape https www. In our case the name of the dataset is the name of the directory the dataset is mounted within. ImageId EncodedPixels 0114f484a16c152baa2d82fdd43740880a762c93f436c8988ac461c5c9dbe7d5 1 1 0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac 1 1 0999dab07b11bc85fb8464fc36c947fbd8b5d6ec49817361cb780659ca805eac 2 3 8 9 etc. com dschettler8845 train sartorius segmentation eda effdet tf scriptVersionId 78096161 to see the training run. What Is a Replica A single Cloud TPU device consists of FOUR chips each of which has TWO TPU cores. 4 CREATE MODEL AND LOAD PRETRAINED WEIGHTS COCO weights5. A false negative indicates a ground truth object had no associated predicted object. csv IDs and masks for all training objects. 2 CREATE A DATASET WITH THE CORRECT STRUCTURE INPUT Raw Image 256x256x3 OUTPUT TARGET Bounding Boxes Instance Classes Segmented Image 64x64x3 We first create the tfrecord datasets. get_gcs_path that will allow us to access the location of our input datasets within GCS. Create a Features message using tf. com stainsby fast tested rle https github. nbsp REFERENCES Guide Use TPUs Doc TPUClusterResolver2. PROJECT my tpu project tpu tf. id unique identifier for object annotation run length encoded pixels for the identified neuronal cell width source image width height source image height cell_type the cell line plate_time time plate was created sample_date date sample was created sample_id sample identifier elapsed_timedelta time since first image taken of sample sample_submission. TABLE OF CONTENTS 0 nbsp nbsp nbsp nbsp IMPORTS 1 nbsp nbsp nbsp nbsp BACKGROUND INFORMATION 2 nbsp nbsp nbsp nbsp SETUP 3 nbsp nbsp nbsp nbsp HELPER FUNCTIONS 4 nbsp nbsp nbsp nbsp DATASET CREATION AND EXPLORATION 5 nbsp nbsp nbsp nbsp MODELLING 0 nbsp nbsp IMPORTS nbsp nbsp nbsp nbsp 10514 1 nbsp nbsp BACKGROUND INFORMATION nbsp nbsp nbsp nbsp 10514 1. The results are improvements in speed and memory usage. Because these kernels are unique to the model they can exploit model specific information for optimization. 2 COMPETITION EVALUATION GENERAL EVALUATION INFORMATIONThis competition is evaluated on the mean average precision at different intersection over union \ud835\udc3c\ud835\udc5c\ud835\udc48 thresholds. either the entire function is compiled with XLA or an errors. 5 TRAIN THE MODEL Since I trained the model in a previous version I will be loading the trained model from that previously trained checkpoint. The training annotations are provided as run length encoded masks and the images are in PNG format. The threshold values range from 0. train_semi_supervised unlabeled images offered in case you want to use additional data for a semi supervised approach. Accurate instance segmentation of these cells with the help of computer vision could lead to new and effective drug discoveries to treat the millions of people with these disorders. 6 VALIDATE THE MODEL IS LEARNING 5. 7 IOU ON VALIDATION DATASET 5. tbd wrap in fn GT Bounding Boxes Confidence Scores Segmentation Mask PRED Bounding Boxes Confidence Scores Instance Classes Segmentation Mask. 5At each threshold value \ud835\udc61 a precision value is calculated based on the number of true positives \ud835\udc47\ud835\udc43 false negatives \ud835\udc39\ud835\udc41 and false positives \ud835\udc39\ud835\udc43 resulting from comparing the predicted object to all ground truth objects frac TP t TP t FP t FN t A true positive is counted when a single predicted object matches a ground truth object with an IoU above the threshold. The file should contain a header and have the following format. Kaggle provides a utility library KaggleDatasets which has a utility function. When using TPU on Kaggle you don t need to specify arguments for TPUClusterResolver 2. You will find extra data for the SH SHY5Y cell line plus several other cell lines not covered in the competition dataset that may be of interest for transfer learning. XLA provides us with an alternative mode of running models it compiles the TensorFlow graph into a sequence of computation kernels generated specifically for the given model. As a result new drugs could be discovered to treat the millions of people with these leading causes of death and disability. SUBMISSION FILE INFORMATIONIn order to reduce the submission file size our metric uses run length encoding RLE on the pixel values. 3 INSTANIATE OUR DATALOADER Augmentations are breaking the masks. Successful models will do this with a high level of accuracy. 1 LOAD EFFICIENTDET MODEL AND INITIALIZE 5. ", "id": "dschettler8845/train-sartorius-segmentation-eda-effdet-tf", "size": "25650", "language": "python", "html_url": "https://www.kaggle.com/code/dschettler8845/train-sartorius-segmentation-eda-effdet-tf", "git_url": "https://www.kaggle.com/code/dschettler8845/train-sartorius-segmentation-eda-effdet-tf", "script": "RobustScaler tf2 Counter load_npz plotly.graph_objects image_preprocess serialize_raw tensorflow_addons util_keras write_tfrecords plot_gt anchors pandarallel plotly.express kaggle_datasets label_util plot_img_and_mask numpy Image seaborn ListedColormap plot_pred get_img_and_mask pd_get_bboxes tf2.train glob inference _int64_feature serialize_test_raw get_bbox_stats get_contour_bbox flatten_l_o_l rle_encode ImageEnhance postprocess GroupKFold; matplotlib.patches precision_at iou_map KaggleDatasets tensorflow dataloader grab_contours matplotlib.pyplot create_id_to_iloc_map PIL matplotlib.colors sklearn.model_selection pandas setup_model load_json_to_dict datetime tqdm.notebook tqdm; tqdm.pandas(); compute_iou rle_decode_top_to_bot_first get_pred_instance_mask seed_it_all train_lib tf_load_image visualize_image PolynomialFeatures vis_utils rle_decode plot_diff _float_feature pandarallel; pandarallel.initialize(); tf_load_png visualize _bytes_feature efficientdet_keras collections efficientdet sklearn.preprocessing ", "entities": "(('Successful models', 'accuracy'), 'do') (('you', 'Project actually that'), 'WARNING') (('where you', 'GCP'), 'b') (('They', 'new therapies'), 'empower') (('you', 'TPUClusterResolver'), 'need') (('nbsp REFERENCES Guide', 'TPUs Doc TPUClusterResolver2'), 'Use') (('images', 'PNG format'), 'provide') (('jit_compile API', 'semantics i.'), 'compile') (('sample_date date sample', 'sample sample_submission'), 'd') (('when you', 'GCP'), 'xxx') (('DATALOADER Augmentations', 'masks'), '3') (('instance Accurate segmentation', 'disorders'), 'lead') (('Current solutions', 'neuronal cells'), 'have') (('semi', 'data4'), 'INVESTIGATE') (('that', 'start position'), 'submit') (('ground truth', 'threshold'), '\ud835\udc61') (('me', 'work'), 'ChallengeCREATED') (('s', 'RLE DECODE FUNCTION https www'), 'VISUALIZE') (('Lastly score', 'test dataset'), 'calculate') (('entire function', 'XLA'), 'compile') (('More specifically you', 'neuronal cells'), 'use') (('com reshape', 'top bottom first ref'), 'namgalielei') (('I', 'previously trained checkpoint'), 'train') (('how well deadly disorders', 'treatment'), 'be') (('that', 'only tf'), 'compile') (('competition format', 'pairs'), 'require') (('them', 'mask commonly used heads'), 'be') (('you', 'get_gcs_path function'), 'TIPS') (('competition we', 'images'), 'OVERVIEW') (('all', 'TensorFlow individually executor'), 'execute') (('intersection', '0'), 'consider') (('executor', 'that'), 'have') (('None', 'test set'), 'provide') (('ground truth object', 'associated predicted object'), 'indicate') (('that', 'image4'), 'let') (('us', 'GCS'), 'get_gcs_path') (('Unfortunately segmenting', 'microscopic images'), 'challenge') (('they', 'optimization'), 'be') (('1 2 3 10 14', 'mask'), 'imply') (('metric uses', 'pixel values'), 'FILE') (('BytesList', 'EagerTensor'), 'Aggregate') (('that', 'more people'), 'bring') (('smaller distributions', 'ref https top www'), 'call') (('copy placeholder paste', 'globe'), 'be') (('you', 'robust quantitative data'), 'help') (('you', 'neurological disorders'), 'detect') (('each', 'TPU TWO cores'), 'consist') (('Don t', 'shape https back original www'), 'run') (('you', 'grpc also path'), 'need') (('They', 'leading field'), 're') (('masks', 'same image'), 'check') (('then we', 'OpenCV v2'), 'use') (('results', 'speed usage'), 'be') (('which', 'light microscopy'), 'be') (('InvalidArgumentError exception', 'nbsp REFERENCE XLA Optimizing Machine Learning2'), 'throw') (('3', '3 pixels'), 'implie') (('that', 'transfer learning'), 'find') (('tuple', 'cv2'), 'py') (('new drugs', 'death'), 'discover') (('row', 'given ImageId'), 'represent') (('competition', 'union \ud835\udc3c\ud835\udc5c\ud835\udc48 thresholds'), 'EVALUATION') (('v4 otherwise OpenCV', 'cv2'), 'beta') (('VISUALIZE LIVECell 3 s', 'LIVECell dataset4'), 'INVESTIGATE') (('one indexedand', 'then right 1'), 'be') (('which', 'utility function'), 'provide') (('Missed Extra We', 'background Correct objects'), 'make') (('predicted object', 'ground truth associated object'), 'indicate') (('We', 'tfrecord first datasets'), 'create') (('Module Imports Detect hardware', 'distribution strategy TPU appropriate detection'), 'TRAINING') (('data', 'S torage directly G oogle C loud GCS'), 'read') (('Submission files', 'size'), 'take') (('dataset', 'directory'), 'be') (('d', 'certain columns4'), 'update') (('This', 'GCP project dashboard page'), 'find') (('that', 'source code potentially changes'), 'be') (('number', 'annotated objects'), 'be') (('com reshape', 'rle4'), 'namgalielei') (('it', 'specifically given model'), 'provide') (('We', 'later purposes4'), 'bboxe') (('which', 'cloud TPUs'), 'DETECTION') (('IoU A B cap B A cup metric sweeps', 'precision average value'), 'calculate') (('com paulorzp', 'https www'), 'run') (('SY5Y', 'cancer cell eight different types'), 'model') (('file', 'following format'), 'contain') (('LIVECell', 'competition'), 'be') (('Sartorius', 'life science research'), 'be') (('Researchers', 'treatment neuronal cells'), 'be') (('when you', 'only notebooks'), 'be') (('WTH', 'contour Exit Else Return only one Get extreme Early Flip black white'), 'signature') (('you', 'semi supervised approach'), 'image') (('that', '10 speedup when tf'), 'be') "}