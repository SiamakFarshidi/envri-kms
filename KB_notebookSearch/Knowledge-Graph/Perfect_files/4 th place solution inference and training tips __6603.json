{"name": "4 th place solution inference and training tips ", "full_name": " h1 Import additional packages h1 Import packages h1 Main Config Variables h1 Audio Preprocessing h2 Utils h2 Main Pipeline h2 Torch Dataset h1 Load Dataframe h1 Initialize Dataset h1 torchaudio utils h1 Resnext initialize functions h1 BIG BIG Model class h2 Model utils h1 ALL My Models h1 Predict Loop h1 Create final submission DF h1 Train Tips h2 Augmentations h3 Gain h3 Background Noise h3 LowFrequency CutOff h3 All Pipeline h2 Mixup h2 Multi Sample Dropout h2 Energy trimming ", "stargazers_count": 0, "forks_count": 0, "description": "5 effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_nocalldatax10 Public score 0. randint low 0 high len self. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05_swa_f1_test_median_fold_1. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_nocalldatax10_swa_f1_test_median_fold_0. 5 Is not used in best Blend initalize_spectral_model NEW_EFFNET3. 5 effnet4_reluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto Public score 0. input cornell birds models effnet3_multiscalereluclas_plato_timefreqencode_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_2. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_ls01_swa_f1_test_median_fold_4. 5 effnet3_multiscalereluclas_plato_timefreqencode_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto Public score 0. mean for i in range n_steps probs softmax np. min_gain_in_db min_gain_in_db self. But Label Smoothing did not work for me in all cases Multi Sample DropoutOriginally proposed in this paper https arxiv. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_nocalldatax10_swa_f1_test_median_fold_4. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_ls01_swa_f1_test_median_fold_1. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05_swa_f1_test_median_fold_0. input cornell birds models effnet3_multiscalereluclas_plato_timefreqencode_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_3. 5 SpecifiedNoise ssd_data birdsong_recognition noisy_samples low_alpha 0. 5 else raise ValueError Invalid probs_comp return probsh_s sr 1w_s sr 5t_pobs compute_sampling_distribution feature compute_normalized_energy au hop_size h_s window_size w_s probs_comp uniform start np. input cornell birds models effnet4_multiscalereluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_3. pt DEVICE effnet5_multiscalereluclas_plato_deltas_32bs_2acum_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto Public score 0. allways_apply alpha np. 5 param p super. input cornell birds models effnet4_multiscalereluclas_plato_deltas_32bs_2acum_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugsless_newbacks_secondarylabels_mixupsumwave05_xeno_canto_swa_f1_test_median_fold_4. input cornell birds models effnet4_multiscalereluclas_plato_deltas_32bs_2acum_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugsless_newbacks_secondarylabels_mixupsumwave05_xeno_canto_swa_f1_test_median_fold_2. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls01_swa_f1_test_median_fold_0. array wave wave np. sum for i in range n_steps probs np. com ex4sperans freesound classification Classifier type Augmentations Final activation Additional features Some additional stuff batch_size 1 time_steps freq_bins batch_size 1 time_steps mel_bins Output shape batch size channels time frequency Output shape batch size channels effnet3_multiscalereluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto Public score 0. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_extxenocanto_swa_f1_test_median_fold_0. com rwightman gen efficientnet pytorch https github. If None no limit Bird code dict Extract data from dataframe We have to load new audio if only 1. Linear hidden_dims classes_num logits torch. allways_apply allways_apply self. BasicTransform def __init__ self p int 0. __init__ p filenames glob pjoin noise_folder_path. max_cutoff au butter_lowpass_filter au cutoff cutoff_value fs sr 1000 return au All Pipeline noisy_samples you can find in this dataset https www. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls01_swa_f1_test_median_fold_2. min_cutoff min_cutoff def apply self au sr if np. com c google quest challenge overview pythonself. input cornell birds models effnet4_multiscalereluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_4. pt DEVICE initalize_spectral_model NEW_EFFNET3_MD_TFE. 5 allways_apply bool False low_alpha float 0. Each model is created by SWA simple averaging of weight matrices from 3 best chekpoints taken for f1_test_median Predict Loop Create final submission DF Train Tips AugmentationsGreat thanks for audiomentations package https github. parameters amplitude_ratio Background Noise pythonclass SpecifiedNoise audiomentations. AddBackgroundNoise ssd_data birdsong_recognition noisy_samples min_snr_in_db 0. Linear nn_embed_size hidden_dims nn. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05_swa_f1_test_median_fold_3. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_swa_f1_test_median_fold_1. 5 effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto Public score 0. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_swa_f1_test_median_fold_0. pt DEVICE effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls005 Public score 0. choice len t_pobs size 1 p t_pobs 0 segment au start h_s start h_s w_s https github. pt DEVICE effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_ls01 Public score 0. See also https en. Dropout p second_dropout_rate nn. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_ls01_swa_f1_test_median_fold_3. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_swa_f1_test_median_fold_4. com vladimirsydor cornelli background noises pythonaudiomentations. 0 super. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_ls01_swa_f1_test_median_fold_2. 5 effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls01 Public score 0. big_dropout x for _ in range 5 dim 0 dim 0 Energy trimmingI have created RMS feature with window size of 5 seconds and step size of 1 second. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05_swa_f1_test_median_fold_4. ndarray hop_size int window_size int probs_comp str softmax n_steps max math. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_nocalldatax10_swa_f1_test_median_fold_3. 5 allways_apply bool False max_cutoff float 5 min_cutoff float 4 super. parameters amplitude_ratio convert_decibels_to_amplitude_ratio random. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_extxenocanto_swa_f1_test_median_fold_4. 5 effnet4_multiscalereluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_0 Public score 0. pt DEVICE effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels Public score 0. randomize_parameters samples sample_rate if self. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_swa_f1_test_median_fold_2. com iver56 audiomentations pythonclass Gain audiomentations. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_extxenocanto_swa_f1_test_median_fold_2. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls01_swa_f1_test_median_fold_4. sum for i in range n_steps probs softmax areas elif probs_comp uniform areas feature hop_size i window_size hop_size i. 5 effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075 Public score 0. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls01_swa_f1_test_median_fold_3. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_nocalldatax10_swa_f1_test_median_fold_2. com zhanghang1989 ResNeSt Sample rate of audio Whether to normalize audio by max np. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_ls01_swa_f1_test_median_fold_1. ceil len feature window_size hop_size 1 if probs_comp softmax areas feature hop_size i window_size hop_size i. input cornell birds models effnet3_multiscalereluclas_plato_timefreqencode_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_4. input cornell birds models effnet4_multiscalereluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_0. pt DEVICE If we have site3 we get list of samples If we have site1 or site2 only one sample If site3 produced very big batch we decompose it in smaller ones Or models are blend with simple Mean Or models are blend with simple Mean Concatanate batches Create DataFrame Aggregate predictions from site3 by Max Handle output for clipwise framewise model. BasicTransform Multiply the audio by a random amplitude factor to reduce or increase the volume. 75 Mixup I have used OR Mixup that was proposed by Dmytro Danevskyi https www. input cornell birds models effnet4_multiscalereluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_2. 5 Is not used in best Blend initalize_spectral_model NEW_EFFNET3_MD_TFE. input cornell birds models effnet3_multiscalereluclas_plato_timefreqencode_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_0. input cornell birds models effnet4_multiscalereluclas_plato_deltas_50bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_1. parameters should_apply self. load noise_path sr None 0 for noise_path in filenames self. __init__ p assert min_gain_in_db max_gain_in_db self. max_gain_in_db def apply self samples sample_rate return samples self. array areas sum areas elif probs_comp rm_softmax areas feature hop_size i window_size hop_size i. input cornell birds models effnet4_multiscalereluclas_plato_deltas_32bs_2acum_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugsless_newbacks_secondarylabels_mixupsumwave05_xeno_canto_swa_f1_test_median_fold_0. Linear hidden_dims hidden_dims nn. Spectral Config Start Spectral Config End Model Config Start Model Config End Feature Extraction Config Start Feature Extraction Config End Other Config Start Other Config End Downsampled ratio Spectrogram extractor Logmel feature extractor Spec augmenter inspired by https github. pt DEVICE effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05_ls005 Public score 0. This technique can help a model become somewhat invariant to the overall gain of the input audio. Then normalized it in order to use as probability distribution for sampling start second of the audio pythondef compute_normalized_energy wave np. high_alpha high_alpha def apply self au sr if np. Warning This transform can return samples outside the 1 1 range which may lead to clipping or wrap distortion depending on what you do with the audio in a later stage. Import additional packages Import packages Main Config Variables Audio Preprocessing Utils Main Pipeline Torch Dataset Load Dataframe Initialize Dataset torchaudio utils Resnext initialize functions BIG BIG Model class Model utils ALL My ModelsAll models are taken from 5 folds so each experiment contains bunch of 5 models. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_nocalldatax10_swa_f1_test_median_fold_1. pt DEVICE effnet4_multiscalereluclas_plato_deltas_32bs_2acum_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugsless_newbacks_secondarylabels_mixupsumwave05_xeno_canto Public score not commited Is not used in best Blend initalize_spectral_model NEW_EFFNET4_MD. input cornell birds models effnet3_multiscalereluclas_plato_timefreqencode_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_xeno_canto_swa_f1_test_median_fold_1. max_gain_in_db max_gain_in_db def randomize_parameters self samples sample_rate super. We just started and we do not have loaded audio Get duration num of seconds Do not process audio less then one sec Padd if we do not have 5 secs in segment dataset created by shonenkov thanks pack batch twice sum of integer squared unpack batch By default use the entire frame Set the default hop if it s not already specified Pad the window out to n_fft size DFT IDFT matrix n_fft 2 1 1 n_fft n_fft 2 1 1 n_fft batch_size channels_num data_length batch_size n_fft 2 1 time_steps batch_size 1 time_steps n_fft 2 1 batch_size n_fft 2 1 time_steps n_fft 2 1 mel_bins Mel spectrogram Logmel spectrogram dim 2 time dim 3 frequency Average over frequency bins. pt DEVICE effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05 Public score 0. 4 Is not used in best Blend initalize_spectral_model NEW_EFFNET4_MD. max_cutoff max_cutoff self. pdf and used by winners of QA competition https www. 1 audiomentations. com iver56 audiomentations GainTaken from https github. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_swa_f1_test_median_fold_3. __init__ p self. pt DEVICE initalize_spectral_model NEW_EFFNET3. power wave 2 def compute_sampling_distribution feature np. high_alpha noise self. min_cutoff high self. com c freesound audio tagging 2019 discussion 97926 I have used high mixup probability 75 Here is full loss function which includes Mixup and Label Smoothing. We get new filename 2. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_extxenocanto_swa_f1_test_median_fold_1. org wiki Clipping_ audio Digital_clipping def __init__ self min_gain_in_db 12 max_gain_in_db 12 p 0. abs Minimum length of audio to predict Computational device Inference batch size Thresholding value Maximum amount of birds in raw. normalize noise for noise in self. 001 max_snr_in_db 2 p 0. pt DEVICE effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_extxenocanto Public score 0. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave075_ls01_swa_f1_test_median_fold_0. allways_apply cutoff_value np. Compose Gain p 0. 75 LowFrequencyMask min_cutoff 5 max_cutoff 7 p 0. Dropout p first_dropout_rate nn. com ddanevskyi here https www. low_alpha low_alpha self. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_extxenocanto_swa_f1_test_median_fold_3. BasicTransform def __init__ self noise_folder_path str p int 0. input cornell birds models effnet3_reluclas_plato_deltas_64bs_001lr_biggerfft_trackmap_energytrimming_topdb80_firstaugs_secondarylabels_mixupsumwave05_swa_f1_test_median_fold_2. 0 high_alpha float 1. noises au au 1 alpha noise alpha return au LowFrequency CutOff pythonclass LowFrequencyMask audiomentations. pt DEVICE initalize_spectral_model NEW_EFFNET4_MD. ", "id": "vladimirsydor/4-th-place-solution-inference-and-training-tips", "size": "6603", "language": "python", "html_url": "https://www.kaggle.com/code/vladimirsydor/4-th-place-solution-inference-and-training-tips", "git_url": "https://www.kaggle.com/code/vladimirsydor/4-th-place-solution-inference-and-training-tips", "script": "torch.nn.functional StrongBCEwithLogitsMixUp(nn.Module) resnext101_32x4d_swsl join __call__ pathlib STFT(DFTBase) Spectrogram(nn.Module) preprocess transform_slice DFTBase(nn.Module) Optional resnext50_32x4d_swsl probs2names numpy Union power_to_db Tuple _sum_mixup Path Loudness(nn.Module) idft_matrix make_delta SpecAugmentation(nn.Module) glob _add_frequency_encoding initalize_spectral_model join as pjoin torch.nn Any os.path tqdm resnest.torch ResNet typing LogmelFilterBank(nn.Module) _resnext compute_deltas forward DropStripes(nn.Module) pandas tqdm.notebook Test2StepDataset(torch.utils.data.Dataset) SpectralEffnet(nn.Module) _add_time_encoding resnest50_fast_1s1x64d Bottleneck load_chkp Mapping __len__ __init__ PreprocessWaveform(object) InfernceDataPipelineFileName2Au(object) dft_matrix List __getitem__ torchvision.models.resnet ReadAudio(object) ", "entities": "(('i', 'hop_size i.'), 'hop_size') (('randomize_parameters', 'sample_rate'), 'sample') (('Multi Sample DropoutOriginally', 'paper https arxiv'), 'work') (('We', 'new audio'), 'have') (('model', 'input audio'), 'help') (('so experiment', '5 models'), 'package') (('high_alpha high_alpha', 'np'), 'apply') (('1 time_steps freq_bins', 'mel_bins shape batch size channels time frequency Output shape batch size 1 time_steps channels'), 'feature') (('models', 'clipwise framewise model'), 'device') (('5', 'Blend'), 'use') (('DFT IDFT batch_size data_length 2 2 2 2 mel_bins Mel spectrogram 2 1 1 2 1 1 batch_size 1 1 n_fft time_steps n_fft 1 Logmel', 'frequency bins'), 'start') (('i', 'hop_size i.'), 'probs_comp') (('which', 'Mixup'), 'audio') (('min_cutoff min_cutoff', 'np'), 'apply') (('pt Public score', 'initalize_spectral_model'), 'DEVICE') (('dim Energy 5 dim 0 trimmingI', '1 second'), 'create') (('4', 'initalize_spectral_model'), 'use') (('noises', 'noise alpha LowFrequency CutOff pythonclass LowFrequencyMask au 1 audiomentations'), 'au') (('butter_lowpass_filter au cutoff fs Pipeline 1000 you', 'https dataset www'), 'au') (('model', 'DF Train Tips audiomentations package https thanks github'), 'create') (('com vladimirsydor cornelli background', 'pythonaudiomentations'), 'noise') (('choice len t_pobs size p t_pobs 0 segment', 'https h_s start github'), 'start') (('5 min_cutoff', 'False max_cutoff'), 'bool') (('5 allways_apply', 'False low_alpha'), 'bool') (('_ _ init _ _ p filenames', 'pjoin noise_folder_path'), 'glob') (('compute_normalized_energy au hop_size window_size probs_comp uniform', 'np'), 'raise') (('Feature Extraction Other Config', 'Config End ratio Spectrogram extractor Logmel feature extractor Spec https Other Downsampled github'), 'Config') (('audiomentations iver56 pythonclass', 'audiomentations'), 'com') (('i', 'hop_size i.'), 'sum') (('you', 'later stage'), 'warn') (('max_gain_in_db def', 'self samples sample_rate return samples self'), 'apply') (('that', 'Dmytro Danevskyi https www'), 'Mixup') "}