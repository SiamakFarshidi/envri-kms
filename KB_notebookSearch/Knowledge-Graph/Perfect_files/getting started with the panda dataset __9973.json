{"name": "getting started with the panda dataset ", "full_name": " h1 Getting started with the PANDA dataset h1 Quickstart reading a patch in 4 lines h1 Using OpenSlide to load the data h2 Loading a slide h1 do someting with the slide here h2 Loading image regions patches h2 Loading label masks h3 Visualizing the masks using PIL h3 Visualizing masks using matplotlib h3 Overlaying masks on the slides h1 Using scikit image tifffile to load the data h2 Loading a slide h2 Loading image regions h2 Loading label masks h1 Interactive viewer for slides ", "stargazers_count": 0, "forks_count": 0, "description": "These masks directly indicate which parts of the tissue are healthy and which are cancerous. By default MultiImage tries to conserve memory usage by only caching the last image level that was accessed. org api python openslide. If you use Qupath and the images do not load try changing the file extension to. Examples of open source viewers that can open the PANDA dataset are ASAP https github. The small size makes it possible to load the slides directly into memory. Mask data is present in the R channel To show the masks we map the raw label values to RGB values Mapping 0 background 1 stroma 2 benign epithelium 3 Gleason 3 4 Gleason 4 5 Gleason 5 Mapping 0 background 1 benign 2 cancer Compute microns per pixel openslide gives resolution in centimeters Optional create a custom color map Load data from the highest level Mask data is present in the R channel Create alpha mask Mapping 0 background 1 stroma 2 benign epithelium 3 Gleason 3 4 Gleason 4 5 Gleason 5 Mapping 0 background 1 benign 2 cancer Deleting the object frees up memory You can also visualize patches with matplotlib Free up memory invisible trace to init axes and to support autoresize Set background image plotly now performs auto conversion of PIL image to png data URI Below is a workaround which rounds image requests to multiples of 4 once the libpixman fix is in place these can be removed Nasty workaround for buggy container Letting PIL do the resize is faster than plotly Update with batch_update so all updates happen simultaneously. These markings are not part of the tissue but were made by the pathologists who originally checked this case. This overlay can help you identifying the different growth patterns. ASAP can also overlay the masks on top of the images using the Overlay functionality. Please refer to the OpenSlide Loading label masks section for more information about the contents of the label masks. 000 whole slide images WSI of prostate biopsies from Radboud University Medical Center and the Karolinska Institute. Loading image regions patchesWith OpenSlide we can easily extract patches from the slide from arbitrary locations. com python docs plotly. Quickstart reading a patch in 4 linesThe example below shows in 4 lines how to extract a patch from one of the slides using OpenSlide. read_region function. This requirement is already met when running this code in a notebook on Kaggle. The information in the masks differ from the two centers Radboudumc Prostate glands are individually labelled. Print the case level label Generate a small image thumbnail Read in the mask data from the highest level We cannot use thumbnail here because we need to load the raw label data. There are noticable color differences between the biopsies this is very common within pathology and is caused by different laboratory procedures. Visualizing the masks using PIL Using a small helper function we can display some basic information about a mask. Make sure tifffile is installed before running the examples below. MultiImage class this class gives the ability to access the individual levels of the image. OpenSlide gives the resolution in centimeters so we convert this to microns. html highlight multiimage skimage. To illustrate we use the same coordinates as in the OpenSlide example To load the same region from level 1 we have to devide the coordinates with the downsample factor 4 per level. At this point image data is read from the file and loaded into memory. Using OpenSlide to load the dataIn the following sections we will load data from the slides with OpenSlide https openslide. This rotation has no clinical value and is only dependent on how the biopsy was collected in the lab. OpenSlide path do someting with the slide herebiopsy. org is similar to loading slides with OpenSlide. The first mask is from Radboudumc and shows two different grades of cancer shown in yellow and orange. The label masks of Karolinska were semi autotomatically generated based on annotations by a pathologist. To extract a certain region of the image you will need to load the whole image at one of the levels. Biopsies can be in different rotations. If you are only interested in the lowest level highest magnification you can also load level 0 using imread https scikit image. Running the cell below loads four example biopsies using OpenSlide. Interactive viewer for slidesUsing Plotly https kite. Note that eventhough a biopsy contains cancer not all epithelial tissue has to be cancerous. html highlight imread skimage. Note In the example below you can also observe a few pen markings on the slide dark green smudges. As with the slides itself the label masks can be opened using OpenSlide. These pen markings are available on some slides in the training set. Valid values are 0 background non tissue or unknown 1 stroma connective tissue non epithelium tissue 2 healthy benign epithelium 3 cancerous epithelium Gleason 3 4 cancerous epithelium Gleason 4 5 cancerous epithelium Gleason 5 Karolinska Regions are labelled. Valid values 0 background non tissue or unknown 1 benign tissue stroma and epithelium combined 2 cancerous tissue stroma and epithelium combined The label masks of Radboudumc were semi automatically generated by several deep learning algorithms contain noise and can be considered as weakly supervised labels. The output is not shown when purely viewing the notebook as it requires access to the source image. You can check the memory usage of the kernel to see that loading the lowest level can require a considerate amount of memory. The benefit of OpenSlide is that we can load arbitrary regions of the slide without loading the whole image in memory. org with tifffile https pypi. x uses an internal version of the tif loader if the tifffile packages is not installed. This viewer is a great way of inspecting the data in more detail. org api python Loading a slideBefore we can load data from a slide we need to open it. Loading a slideLoading a slide with scikit image https scikit image. Still upon loading the image is uncompressed resulting in larger memory usage. This is different from Openslide that always works with coordinates from level 0. Biopsies can contain a mix of cancerous and healthy tissue. The label information is stored in the red R channel the other channels are set to zero and can be ignored. Loading a specific region is done using the read_region https openslide. Tip Want to view the slides in a more interactive way Using a WSI viewer you can interactively view the slides. There are two ways to load the data from the PANDA dataset Option 1 Load images using openslide Option 2 Load images using skimage requires that tifffile is installed General packages Plotly for the interactive viewer see last section Location of the training images Location of training labels Open the image does not yet read the image into memory Read a specific region of the image starting at upper left coordinate x 17800 y 19500 on level 0 and extracting a 256 256 pixel patch. Want to interactively view a slide We have added an interactive viewer Interactive viewer for slides to this notebook in the last section. org project tifffile as the backend. The code below loads each individual level. close For this tutorial we created a small function to show some basic information about a slide. pythonbiopsy openslide. The cells below shows two example masks from the dataset. If you prefer something like matplotlib you can also use plt. Each slide has 3 levels you can load corresponding to a downsampling of 1 4 and 16. Using this viewer you can load any image from the PANDA dataset and interactively zoom in to specific regions. Loading label masksApart from the slide level label present in the csv file almost all slides in the training set have an associated mask with additional label information. Getting started with the PANDA datasetThis notebook shows a few methods to load and display images from the PANDA challenge dataset. Because the image is already in memory this boils down to a slice on the numpy array. Using the level argument we can easily load in data from any level that is present in the slide. Visualizing masks using matplotlib Given that the masks are just integer matrices you can also use other packages to display the masks. After opening the slide we can for example load a 512x512 patch from the lowest level level 0 at a specific coordinate. Want to investigate slides locally on your machine Using a WSI viewer you can interactively view the slides on your own machine. Additionally this function display a small thumbnail of the slide. 000 pixels in both x and y. As the label information is in the R channel other channels can be discarded. imshow to directly show a mask without converting it to an RGB image. graph_objs we can make an interactive viewer that works inside a notebook. Using scikit image tifffile to load the dataAs an alternative to OpenSlide the slides in the PANDA dataset can also be loaded using scikit image https scikit image. This internal version does not support JPEG compression and can not be used to load the images in the dataset. Intermediate levels can be created by downsampling a higher resolution level. Loading label masksLoading label masks using scikit image is similar to loading the slides. The major difference between scikit image and OpenSlide is that scikit image loads the image into memory. Slides are loaded using the MultiImage https scikit image. The dataset consists of around 11. The label masks are stored in an RGB format so that they can be easily opened by image readers. The dimensions of each level differ based on the dimensions of the original image. Display the image Close the opened slide after use Generate a small image thumbnail Here we compute the pixel spacing the physical size of a pixel in the image. Note scikit image 0. All images in the dataset contain this metadata and you can use this in your data pipeline. After a file is open we can retrieve data from it at arbitratry positions and levels. Coordinates passed to read_region are always relative to level 0 the highest resolution. You can read more about the OpenSlide python bindings in the documentation https openslide. Some things you can notice The image dimensions are quite large typically between 5. To more easily inspect the masks we map the int labels to RGB colors using a color palette. imread Loading image regionsSimilar to OpenSlide we can extract regions from the whole image. com computationalpathologygroup ASAP and QuPath https qupath. The images in the PANDA dataset are relatively small because each biopsy was individually extracted from the source slide. Note The code below only works when you run this notebook yourself. To do this we load both the mask and the biopsy and merge them using PIL. The second mask is from Karolinska the region that contains cancer is higlighted in red. For example using matplotlib and a custom color map we can quickly visualize the different cancer regions Overlaying masks on the slidesAs the masks have the same dimension as the slides we can overlay the masks on the tissue to directly see which areas are cancerous. ", "id": "wouterbulten/getting-started-with-the-panda-dataset", "size": "9973", "language": "python", "html_url": "https://www.kaggle.com/code/wouterbulten/getting-started-with-the-panda-dataset", "git_url": "https://www.kaggle.com/code/wouterbulten/getting-started-with-the-panda-dataset", "script": "numpy show matplotlib.pyplot display print_slide_details print_mask_details __init__ IPython.display _gen_zoomed_image _update_image plotly.graph_objs overlay_mask_on_slide pandas set_slide WSIViewer(object) Image ", "entities": "(('sure tifffile', 'examples'), 'make') (('that', 'slide'), 'use') (('Intermediate levels', 'resolution higher level'), 'create') (('almost all slides', 'label additional information'), 'have') (('OpenSlide path', 'slide herebiopsy'), 'somete') (('we', 'memory'), 'be') (('scikit image', 'memory'), 'be') (('epithelial tissue', 'cancer'), 'note') (('only how biopsy', 'lab'), 'have') (('Biopsies', 'cancerous tissue'), 'contain') (('it', 'directly memory'), 'make') (('we', 'it'), 'python') (('class', 'image'), 'give') (('you', 'also plt'), 'use') (('viewer', 'more detail'), 'be') (('that', 'red'), 'be') (('internal version', 'dataset'), 'support') (('you', 'growth different patterns'), 'help') (('requirement', 'Kaggle'), 'meet') (('Loading', 'read_region https'), 'do') (('we', 'color palette'), 'inspect') (('which', 'tissue'), 'indicate') (('other channels', 'zero'), 'store') (('you', 'levels'), 'extract') (('we', 'PIL'), 'load') (('notebook', 'PANDA challenge dataset'), 'show') (('we', 'arbitratry positions'), 'retrieve') (('you', 'own machine'), 'view') (('directly areas', 'tissue'), 'visualize') (('that', 'notebook'), 'make') (('images', 'file extension'), 'try') (('that', 'level'), 'be') (('this', 'numpy array'), 'boil') (('Coordinates', 'always level'), 'pass') (('that', 'PANDA dataset'), 'be') (('relatively biopsy', 'source individually slide'), 'be') (('other channels', 'R channel'), 'discard') (('Quickstart', 'OpenSlide'), 'read') (('we', 'mask'), 'display') (('Additionally function', 'slide'), 'display') (('we', 'whole image'), 'imread') (('we', 'OpenSlide https'), 'use') (('Running', 'OpenSlide'), 'load') (('label masks', 'pathologist'), 'generate') (('1 we', '4 level'), 'have') (('that', 'image only last level'), 'try') (('dimensions', 'original image'), 'differ') (('who', 'originally case'), 'be') (('it', 'source image'), 'show') (('only when you', 'notebook'), 'note') (('Slides', 'MultiImage https scikit image'), 'load') (('org', 'OpenSlide'), 'be') (('slides', 'scikit image https scikit also image'), 'load') (('We', 'last section'), 'want') (('you', '1 4'), 'have') (('loading', 'memory'), 'check') (('pixel', 'image'), 'display') (('here we', 'label raw data'), 'print') (('You', 'documentation https'), 'read') (('they', 'image easily readers'), 'store') (('Loading label', 'slides'), 'be') (('we', 'slide'), 'create') (('cells', 'dataset'), 'show') (('you', 'https scikit 0 imread image'), 'load') (('image data', 'memory'), 'read') (('you', 'data pipeline'), 'contain') (('this', 'laboratory different procedures'), 'be') (('Location', '256 pixel 0 256 patch'), 'be') (('you', 'interactively slides'), 'want') (('information', 'centers Radboudumc Prostate two glands'), 'label') (('image dimensions', 'quite typically 5'), 'be') (('tifffile packages', 'tif loader'), 'use') (('so updates', 'batch_update'), 'be') (('label masks', 'OpenSlide'), 'open') (('3 Karolinska 2 healthy benign epithelium 3 cancerous epithelium 4 cancerous 4 5 cancerous Gleason 5 Regions', 'stroma 0 background non unknown 1 connective non epithelium tissue'), 'be') (('so we', 'microns'), 'give') (('we', '0 specific coordinate'), 'load') (('integer just you', 'masks'), 'visualize') (('code', 'individual level'), 'load') (('pen markings', 'training set'), 'be') (('Still image', 'memory larger usage'), 'uncompressed') (('you', 'interactively specific regions'), 'load') (('we', 'arbitrary locations'), 'extract') (('tissue tissue label unknown 1 benign epithelium combined 2 cancerous masks', 'weakly supervised labels'), 'combine') (('ASAP', 'Overlay functionality'), 'overlay') (('first mask', 'yellow'), 'be') "}