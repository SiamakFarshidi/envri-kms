{"name": "e commerce customer segmentation ", "full_name": " h1 Understanding the content of Data h3 This is a transnational data set which contains all the transactions occurring between 01 12 2010 and 09 12 2011 for a UK based and registered non store online retail The company mainly sells unique all occasion gifts Many customers of the company are wholesalers h1 1 Data Preparation h1 Null Values h1 Duplicate Entries h1 2 Exploring the Contents of the Variables h1 Visualizing the Countries from where the orders are getting placed and cancelled h1 Observation h3 We have a lot of variety to cover h3 From the above table there are some observations which we can figure out h1 3 Intuitions about the categories of the product the customer buys h4 Product Description h4 Data Encoding h1 Creating the clusters of product h1 WordCLoud foe each cluster h1 4 Categories of the Customer that buys the product h1 5 Classifying customers h3 Support Vector Machine h1 Confusion Matrix h1 Learning Curves h1 Logistic Regression h1 k Nearest neighbors h1 Random Forest h1 Adaboost Classifier h1 Gradient Boosting ", "stargazers_count": 0, "forks_count": 0, "description": "Else if if there existys atleast one counter part add it to the doubtful_entry. To do this I define a class to create Radar Charts This allows to have a global view of the content of each cluster It can be seen for example that the first 5 clusters correspond to a strong preponderance of purchases in a particular category of products. When calling this method I provide as parameters The hyperparameters for which I will seek an optimal value The number of folds to be used for cross validation Confusion Matrix Learning Curves Logistic Regression k Nearest neighbors Random Forest Adaboost Classifier Gradient Boosting Importing all the required libraries Ignoring the warnings Setting the default style of Matplotlib Loading the Data getting the information about the column type and the null values show first 5 lines gives some information on columns types and numer of null values in each column nb or no both are same Cancelation WITHOUT counterpart Cancelation WITH a counterpart Various counterparts exist in orders we delete the last one sum of purchases user order date of the order selection of significant entries Purchase statement Representation of the number of purchases amount collect the words root association root keyword Aggregate the silhouette scores for samples belonging to cluster i and sort them Label the silhouette plots with their cluster numbers at the middle Compute the new y_lower for next plot define individual silouhette scores and do the graph define the color of the words I set the legend abreviation airline name sum of purchases user order percentage of order price product category date of the order selection of significant entries number of visits and stats on the amount of the cart users I set the legend abreviation airline name define individual silouhette scores and do the graph Correcting time range. I thus determine the number of purchases made by the user as well as the minimum maximum average amounts and the total amount spent during all the visits Finally I define two additional variables that give the number of days elapsed since the first purchase FirstPurchase and the number of days since the last purchase LastPurchase A customer category of particular interest is that of customers who make only one purchase. Maybe this is quite a considerable amount of number 16. I therefore create a new dataframe that contains for each order the amount of the basket as well as the way it is distributed over the 5 categories of products The dataframe basket_price contains information for a period of 12 months. We have a lot of variety to cover Now let us see how many of the purchases made by the customer got cancelled as it would be having a huge impact on our analysis in the future. Hence I add 6 extra columns to this matrix where I indicate the price range of the products And to choose the appropriate ranges I check the number of products in the different groups Creating the clusters of product In order to define approximately the number of clusters that best represents the data I use the silhouette score In practice the scores obtained above can be considered equivalent since depending on the run scores of 0. More generally we see that there is always a representation in which two clusters will appear to be distinct. starting with C which means that the3 customer has cancelled the order. In part I find that this type of customer represents 1 3 of the customers listed The dataframe transactions_per_user contains a summary of all the commands that were made. This function takes as input the dataframe and analyzes the content of the Description column by performing the following operations extract the names proper common appearing in the products description for each name I extract the root of the word and aggregate the set of names associated with this particular root count the number of times each root appears in the dataframe when several words are listed for the same root I consider that the keyword associated with this root is the shortest name this systematically selects the singular when there are singular plural variants The first step of the analysis is to retrieve the list of products Once this list is created I use the function which was previously defined in order to analyze the description of the various products The execution of this function returns three variables keywords the list of extracted keywords keywords_roots a dictionary where the keys are the keywords roots and the values are the lists of words associated with those roots count_keywords dictionary listing the number of times every word is usedAt this point I convert the count_keywords dictionary into a list to sort the keywords according to their occurences Now we will create a representation of the most frequently repeating wordsThe list that was obtained contains more than 1400 keywords and the most frequent ones appear in more than 200 products. In order to ensure a good classification at every run of the notebook I iterate untill we obtain the best possible silhouette score which is in the present case around 0. Later one of the objectives will be to develop a model capable of characterizing and anticipating the habits of the customers visiting the site and this from their first visit. Data EncodingThe X matrix indicates the words contained in the description of the products using the one hot encoding principle. I use this information to characterize the different types of customers and only keep a subset of variables In practice the different variables I selected have quite different ranges of variation and before continuing the analysis I create a matrix where these data are standardized In the following I will create clusters of customers. Hence I will now try to understand the content of these clusters in order to validate or not this particular separation. SO a question comes in mind if this would be true for all the entries. WordCLoud foe each clusterPrinciple Component AnalysisWe see that the number of components required to explain the data is extremely important we need more than 100 components to explain 90 of the variance of the data. Other clusters will differ from basket averages mean the total sum spent by the clients sum or the total number of visits made count. 2 of the dataframe entries. Let us see what will happen if we remove the Description of Category Again the hypothesis is not fulfilled. Now in order to get the total price of each of the customer let us create a new column that would contain the total price of individual customer. Numerical Product price per unit in sterling. In order to be able to test the model in a realistic way I split the data set by retaining the first 10 months to develop the model and the following two months for tesring and predicting In a second step I group together the different entries that correspond to the same user. To develop a model that allows to anticipate or predict the purchases that will be made by a new customer during the following this year based on the data available from the previous purchases. In practice before creating these clusters it is interesting to define a base of smaller dimension allowing to describe the scaled_matrix matrix. First in order to simplify their use I define a class that allows to interface several of the functionalities common to these different classifiers Since the goal is to define the class to which a client belongs and this as soon as its first visit I only keep the variables that describe the content of the basket and do not take into account the variables related to the frequency of visits or variations of the basket price over time Finally I split the dataset in train and test sets Support Vector MachineThe first classifier I use is the SVC classifier. Observation From the table there are few things that are noticeable1. If various counter parts exist we remove the last counter part. Intuitions about the categories of the product the customer buysIn the dataframe products are uniquely identified through the StockCode variable. In order to use it I create an instance of the Class_Fit class and then callgrid_search. It remains to understand the habits of the customers in each cluster. In practice I decide to keep only a limited number of components since this decomposition is only performed to visualize the data 4. Testing the Predictions Understanding the content of Data This is a transnational data set which contains all the transactions occurring between 01 12 2010 and 09 12 2011 for a UK based and registered non store online retail. In this case I will use this base in order to create a representation of the different clusters and thus verify the quality of the separation of the different groups. Intuitions about the categories of the product the customer buys4. Many customers of the company are wholesalers. UnitPrice Unit price. Each entry of the dataframe indicates prices for a single kind of product. Why not apply some statistics and python and check out if our hypothesis would prove out to be true or False So the hypothesis is not fulfilled as this time the Description of Discount has been taken into consideration. Now let us see that the orders which are getting placed or cancelled belongs to which countries. The other list would contain the entries in which there exists atleast one counterpartThe list will have the name as entry_to_remove and doubtful_entry respectively. I collect all the purchases made during a single order to recover the total order price Now with the help of PIE CHART let us see what are the prices proportion of which the purchases are made. This gives access to for example the average baskets price the number of visits or the total sums spent by the clients of the different clusters. Classifying the Customers based on some parameters6. Whola now there are no null values present in any of the column and the Data Types of each of the column as observed from the above table is appropriate. However while examinating the content of the list I noticed that some names are useless. Categorical a 6 digit integral number which is uniquely assigned to each transaction carried out. To do so I start by adding to the selected_customers dataframe a variable that defines the cluster to which each client belongs Then I average the contents of this dataframe by first selecting the different groups of clients. Data PreparationIn the first step we will load the Data and the main objective would be to find the null values related to the different coumns and then deciding whether to replace those None values or to drop those null values depending upon the percentage proportion of those null values with respect to the entire column. Product Description Since product description would turn out to be a key in the product analyses if would be important to extract the description. e the 2nd entry consists fo the InvoiceNo. From the above table there are some observations which we can figure out. Now I check the number of entries that correspond to cancellations and that have not been deleted with the previous filter Now in the StockCode there are some Capital letters which have some description. So let us move forward. Therefore I discard these words from the analysis that follows and also I decide to consider only the words that appear more than 13 times. One of the objectives may be for example to target these customers in order to retain them. Now let us see that the customer who purchases the item purchases how much quantity of the items. Categories of the Customer that buys the product5. If this code starts with letter c C it indicates the order is cancelled. Visualizing the Countries from where the orders are getting placed and cancelled. The objective is to make this classification possible at the first visit. In practice I decide to delete all of these entries which count respectively for 1. The dataframe has also included the customers who cancelled the purchases i. To do this I create the categorical variable categ_product where I indicate the cluster of each product In a second step I decide to create the categ_N variables with N 0 4 that contains the amount spent in each product category Up to now the information related to a single order was split over several lines of the dataframe one line per product. I also determine the number of clients in each group variable size Finally I re organize the content of the dataframe by ordering the different clusters first in relation to the amount wpsent in each product category and then according to the total amount spent Customers morphologyFinally I created a representation of the different morphotypes. The company mainly sells unique all occasion gifts. Quantity The quantities of each product item per transaction. Null Values From the first table we can say that in the CustomerId column about 25 of the entire column are of Null values. A short description of the products is given in the Description variable. There are also customers who purchases a single item and then went away. Categorical the name of the country where each customer resides. In this section I intend to use the content of this latter variable in order to group the products into different categories. So we should leave our hypothesis and move to the next step. The quantity is indicated as the negative of the quantites that were placed earlier making the net summation to zero. CustomerID Customer number. If the entry gets cancelled with its counter part add the index of the element to te entry_to_remove list. I decide to collect the information related to a particular order and put in in a single entry. Analyzing the content of the E Commerce database that contains the purchases made by approximate 4000 customers over a period of one year2. This would be of a great deal to the E Commerce retailer. Also the customer s purchases are not bound by a specific number it can also go high as 47 maybe some wholesale customer as well 3. Score of the silhouette intra clusterAs with product categories another way to look at the quality of the separation is to look at silouhette scores within different clusters Customers morphotypeAt this stage I have verified that the different clusters are indeed disjoint at least in a global way. StockCode Product item code. Categories of the Customer that buys the productIn the previous section the different products were grouped in five clusters. Hence orders are split on several lines. So what the above function tells is 1. At first I use the result of the PCA in order to create a representation of the various clusters From this representation it can be seen for example that the first principal component allow to separate the tiniest clusters from the rest. 5 so we would be also going to analyse the portion of cancelled orders. Just an intuiton Among these entries the lines listed in the doubtful_entry list correspond to the entries indicating a cancellation but for which there is no command beforehand. Numerical the day and time when each transaction was generated. It can be seen that the data consists of 4372 users and that they bought 3684 different products. Categorical a 5 digit integral number uniquely assigned to each distinct product. Categorical a 5 digit integral number uniquely assigned to each customer. I choose the number of clusters based on the silhouette score and I find that the best score is obtained with 11 clusters At first I look at the number of customers in each cluster There is a certain disparity in the sizes of different groups that have been created. Each entry in this dataframe corresponds to a particular client. Corresponding to the cancelled orders there is a next line just below the line where ths summary of the order has been listed. To fulfill this objective I will test several classifiers implemented in scikit learn. Duplicate Entries Let us check for the duplicate entries of the DataFrame 2. A list that contains the entries in which the orders gets cancelled with its counterpart. Classifying customersIn this part the objective will be to adjust a classifier that will classify consumers in the different client categories that were established in the previous section. Country Country name. Others are do not carry information like colors. As for now let us see the first 5 columns of the dataframe. Description Product item name. Now if we see the Dataframe it consists of large number of enteries so what does thses entereies correspond to Let us find out. 05 will be obtained for all clusters with n_clusters 3 we obtain slightly lower scores for the first cluster. InvoiceDate Invice Date and time. I therefore perform a PCA beforehand and then I represent the amount of variance explained by each of the componentsAt this point I define clusters of clients from the standardized matrix that was defined earlier and using the k means algorithm fromscikit learn. 15 Checking the content of Clusters In order to have an insight on the quality of the classification we can represent the silhouette scores of each element of the different clusters. The total number of transactions carried out is of the order of 22 000. Exploring the Contents of the Variables InvoiceNo Invoice number. Now in order to deal with the negative numbers present in the Quantites column adn the cancelled order the thing that we can do is Create two list 1. In practice I have found that introducing the price range results in more balanced groups in terms of element numbers. In order to prepare the rest of the analysis a first step consists in introducing this information into the dataframe. So it would be a better choice to remove those null values as if we replace those null values by some central measures we would be introducing bias to it. Exploring the content of variables in short Exploratory Data Analysis not inlcuding the product category 3. ", "id": "akarshupadhyay/e-commerce-customer-segmentation", "size": "17297", "language": "python", "html_url": "https://www.kaggle.com/code/akarshupadhyay/e-commerce-customer-segmentation", "git_url": "https://www.kaggle.com/code/akarshupadhyay/e-commerce-customer-segmentation", "script": "title linear_model pathlib init_notebook_mode predict keywords_inventory IPython.display legend confusion_matrix grid_search graph_component_silhouette sklearn.svm numpy sklearn.cluster ensemble seaborn Class_Fit(object) train preprocessing Path grid_predict STOPWORDS SVC tree fill plot_confusion_matrix matplotlib.patches sklearn learning_curve neighbors PCA matplotlib.cm random_color_func matplotlib.pyplot make_wordcloud plot_learning_curve metrics svm sklearn.model_selection pandas plotly.graph_objs plotly.offline KMeans iplot plot RadarChart() silhouette_samples _scale_data model_selection wordcloud matplotlib silhouette_score WordCloud feature_selection AdaBoostClassifier display HTML __init__ grid_fit GridSearchCV sklearn.decomposition sklearn.metrics sklearn.ensemble StandardScaler sklearn.preprocessing ", "entities": "(('we', 'two list'), 'create') (('different clusters', 'indeed at least global way'), 'be') (('2nd entry', 'InvoiceNo'), 'consist') (('lines', 'which'), 'correspond') (('I', 'customers'), 'use') (('information', 'product'), 'create') (('This', 'E Commerce retailer'), 'be') (('which', 'countries'), 'let') (('which', '0'), 'in') (('I', 'single entry'), 'decide') (('which', 'respectively 1'), 'decide') (('Later one', 'first visit'), 'be') (('I', 'Class_Fit class'), 'create') (('average baskets', 'different clusters'), 'give') (('Description', 'consideration'), 'apply') (('we', 'different clusters'), '15') (('So we', 'next step'), 'leave') (('entry', 'product'), 'indicate') (('this', 'entries'), 'come') (('that', 'zero'), 'indicate') (('that', 'previous section'), 'be') (('scores', '0'), 'add') (('Capital which', 'description'), 'check') (('that', 'available previous purchases'), 'develop') (('that', 'only words'), 'discard') (('Again hypothesis', 'Category'), 'fulfil') (('that', 'same user'), 'in') (('I', 'scikit'), 'test') (('that', 'commands'), 'find') (('we', 'entire column'), 'PreparationIn') (('orders', 'counterpart'), 'list') (('first 5 clusters', 'products'), 'define') (('ths where summary', 'order'), 'be') (('two clusters', 'always which'), 'see') (('who', 'only one purchase'), 'determine') (('company', 'occasion gifts'), 'sell') (('legend abreviation airline name', 'time range'), 'call') (('more than 1400 keywords', 'most frequent more than 200 products'), 'take') (('extremely we', 'data'), 'foe') (('Others', 'colors'), 'carry') (('classification', 'first visit'), 'be') (('Hence I', 'order'), 'try') (('entry', 'te entry_to_remove list'), 'add') (('counterpartThe one list', 'entry_to_remove'), 'contain') (('who', 'items'), 'let') (('algorithm fromscikit', 'earlier k'), 'perform') (('names', 'list'), 'notice') (('I', 'train'), 'define') (('dataframe products', 'StockCode uniquely variable'), 'identify') (('customer', 'product'), 'intuition') (('about 25', 'Null values'), 'value') (('we', 'last counter part'), 'remove') (('I', 'different groups'), 'use') (('who', 'purchases'), 'include') (('Other clusters', 'total visits'), 'differ') (('Data EncodingThe X matrix', 'encoding one hot principle'), 'indicate') (('that', 'product5'), 'category') (('one counter part', 'doubtful_entry'), 'else') (('Exploring', 'product category'), 'inlcude') (('purchases', 'which'), 'collect') (('also who', 'single item'), 'be') (('where orders', 'Countries'), 'visualize') (('3 we', 'first cluster'), 'obtain') (('first principal component', 'rest'), 'use') (('which', 'uniquely transaction'), 'carry') (('we', 'it'), 'be') (('us', 'dataframe'), 'let') (('us', 'enteries'), 'consist') (('where customer', 'country'), 'categorical') (('it', 'future'), 'have') (('Maybe this', 'considerable number'), 'be') (('the3 customer', 'order'), 'start') (('order', 'letter c C'), 'start') (('It', 'cluster'), 'remain') (('One', 'them'), 'be') (('Whola', 'above table'), 'be') (('I', 'different categories'), 'intend') (('I', 'element numbers'), 'find') (('morphologyFinally I', 'different morphotypes'), 'determine') (('it', 'also high 47'), 'bind') (('so we', 'cancelled orders'), '5') (('short description', 'Description variable'), 'give') (('that', 'different groups'), 'choose') (('total number', '22 000'), 'be') (('they', '3684 different products'), 'see') (('we', 'which'), 'be') (('Product product description', 'description'), 'description') (('decomposition', 'only data'), 'decide') (('few that', 'table'), 'be') (('different products', 'five clusters'), 'category') (('us', 'DataFrame'), 'let') (('Many customers', 'company'), 'be') (('it', 'scaled_matrix matrix'), 'be') (('data transnational which', '2010 12 UK'), 'test') (('first step', 'dataframe'), 'consist') (('dataframe basket_price', '12 months'), 'create') (('entry', 'particular client'), 'correspond') (('that', 'one year2'), 'analyze') (('that', 'individual customer'), 'in') (('Then I', 'clients'), 'start') "}