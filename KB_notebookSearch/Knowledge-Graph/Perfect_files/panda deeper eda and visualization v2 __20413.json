{"name": "panda deeper eda and visualization v2 ", "full_name": " h1 Deeper Exploratory Data Analysis of PANDA h2 About the notebook h2 Domain Knowledge h3 Question 1 What is Prostate Cancer h3 Question 2 How is Prostate Cancer tested and detected h3 Question 3 What is Gleason score and how does it fit into all this h3 Question 4 What is ISUP grade and how is it related to Gleason score h3 Question 5 How have Gleason scores been generated in the dataset h1 Now Let s Get Started with PANDA Dataset h2 Loading of the Required Dependencies h2 Loading of the Data h3 Directories Exploration h3 Load the Data and Check the Content h4 Checking for the Training Samples h4 Inference h4 About the Output Variables h4 Checking Missing Information h4 Checking of test csv File Content h1 Performing of Some Basic EDA h2 Checking of the Size of Training label masks and Samples and h3 Inference h2 Checking of the Distribution of Data Provider ISUP Grade and Gleason Score h3 Auxilary Function h3 Summary of Counts h3 Visualization h3 Inferences on the Distributions h4 About the Distribution of ISUP Grade h4 About the Distribution of Gleason Socre h2 Checking for the Relative Distributions RDs h3 Inferences on the Relative Distributions h4 About ISUP Score and Data Provider h4 AboutGleason Score and Data Provider h1 Some Advanced EDA h2 Loading and Quickly Displaying of some few WSIs h3 Checking of some Generalizable Properties on the Data h3 Some Few Insights h3 Let s Resize and Visualize the 9 Randomly Selected Biopsy Images h3 Exploration and Analysis of the Training Label Masks h4 Overview h4 Loading of label masks and Visualization h4 Prepare the Training Sample Images with their Corresponding Masks h4 Plotting of some Image and Masks According to sup grade Category h4 Visualization h3 Overlaying of Training Label Masks on their Corresponding Whole Slide Images h4 Auxiliary functions for this tasks h4 Visualization h4 Some Few Insights h3 Let s Explore few of these Images with Pen Markers h2 Distributions of the Dimensions width hight of Training Samples h3 Extraction of Dimensions width hight and Merging with the Train Data h3 Visualization of some Insighful Distributions h4 Auxiliary Function h4 Inferences on the Distributions h2 Inspirational References ", "stargazers_count": 0, "forks_count": 0, "description": "Such tests can include Ultrasound If other tests raise concerns your doctor may use transrectal ultrasound to further evaluate your prostate. Gleason scoring combines two numbers and can range from 1 10 and describes how much the cancer from a biopsy looks like healthy tissue lower score or less aggressive or abnormal tissue higher score or very aggressive. The PANDA dataset are whole slide images WSIs stored in Tag Image File Format. As the competition organizers described slightly different procedures were in place for the images used in the test set than the training set. This is a standard way of staining the originally transparent tissue to produce some contrast. Gleason Score and Data Provider Inferences on the Relative Distributions About ISUP Score and Data Provider In isup_grade category 0 and 1 most of the data is provided by karolinska. Question 4 What is ISUP grade and how is it related to Gleason score According to current guidelines by the International Society of Urological Pathology ISUP the Gleason scores are summarized into an ISUP grade on a scale from 1 to 5 according to the following rule Gleason score 6 ISUP grade 1 Gleason score 7 3 4 ISUP grade 2 Gleason score 7 4 3 ISUP grade 3 Gleason score 8 ISUP grade 4 Gleason score 9 10 ISUP grade 5If there is no cancer in the sample we use the label ISUP grade 0 in this competition. split function that will split the image mask into individual bands channels. This overlay can help you identifying the different growth patterns. It is defined by the kaggle python Docker image https github. input directory For example running this by clicking run or pressing Shift Enter will list all files under the input directory Full file directory Openining without reading the image into memory Full file directory Openining without reading the image into memory Full file directory Openining without reading the image into memory Creation of the patch to plot Get the last level slide Get the dimension corresponding of the last level Plot the patch Full file directory Openining without reading the image into memory Creation of the patch to plot Get the last level slide Get the dimension corresponding of the last level Resize the image patch Plot the resized image patch Full file directory Openining without reading the image into memory Creation of the patch to plot Get the last level slide Get the dimension corresponding of the last level Plot In train_ids I set index to image_id Recall mask_id image_id _mask. The most common scale used to evaluate the grade of prostate cancer cells is called a Gleason score. Loading of label masks and Visualization Prepare the Training Sample Images with their Corresponding Masks. About Gleason Score and Data Provider In gleason_score category 0 0 all the data is provided by karolinska. The prostate is nothing but a small walnut shaped gland in men that produces the seminal fluid that nourishes and transports sperm as depicted in the figure below. Rest of the data samples have associated ISUP grades from 2 to 5 with all ranging in the 11 12 each. Let s Resize and Visualize the 9 Randomly Selected Biopsy Images skimage. The most common blue outline Gleason pattern 3 and second most common red outline Gleason pattern 4 cancer growth patterns present in the biopsy dictate the Gleason score 3 4 for this biopsy which in turn is converted into an ISUP grade 2 for this biopsy following guidelines of the International Society of Urological Pathology. Each epithelial unit is separate and has a lumen. resize but the former currently fails fails on the latest version of the Kaggle Docker image to the following packages imagecodecs and tifffile. There are noticable color differences between the biopsies this is very common within pathology and is caused by different laboratory procedures. ISUP Grade and Data Provider 1. However while some types of Prostate Cancer grow slowly and may need minimal or even no treatment other types are aggressive and can spread quickly. However the information in the masks differ from the two centers. Few gleason_score like 3 3 and 0 0 are more frequent while others like 3 5 and 5 3 are very rare in this dataset. All the training images do not have masks as we can see that the size of the training samples is 10616 whereas the sample mask size is only 10516. The glands are hollow structures which can be seen as white holes or branched cavities in the WSI. There are also some poorly formed small glands and some fused glands. About the Distribution of Gleason Socre From above graph it is clear that gleason_score distribution is not uniform. Examples of patterns used for grading. The samples are made up of glandular tissue and connective tissue. This rotation has no clinical value and is only dependent on how the biopsy was collected in the lab. nl en research and the Karolinska Institute https ki. epithelial sheets with multiple lumina. Load the Data and Check the Content Checking for the Training Samples InferenceWe can notice from the outputs of the cell above that The training samples directory train_images contains exactly 10616 files that matches the number of samples in the train. To do this we load both the mask and the biopsy with OS. Exploration and Analysis of the Training Label Masks OverviewApart from the slide level label present in the csv file almost all slides in the training set have an associated mask with additional label information. Question 3 What is Gleason score and how does it fit into all this When a biopsy confirms the presence of cancer the next step is to determine the level of aggressiveness grade of the cancer cells. What we learned from these outputs are the following The image dimensions are quite large ranging typically between about 4 000 and 40 000 pixels in both x and y. Also in gleason_score category 3 3 karolinska is major data provider. ListedColormap black gray green yellow orange red Open a slide wsi Full file directory Openining without reading the image into memory Open the corresponding mask Creation of the patch to visualize Get the last level slide Get the dimension corresponding of the last level Split the patch mask into channels Create alpha mask Mapping 0 background 1 stroma 2 benign epithelium 3 Gleason 3 4 Gleason 4 5 Gleason 5 Mapping 0 background 1 benign 2 cancer Overlay the mask on its corresponding slide Plot the overlayed image Open a slide wsi Full file directory Openining without reading the image into memory. To do this we are going to start by trying to successively address these five key questions what is Prostate Cancer How is it tested and detected What is Gleason score and how does it fit into all this What is ISUP grade and how is it related to Gleason score How have Gleason scores been generated So let us start looking into these questions Question 1 What is Prostate Cancer Prostate Cancer is a cancer that occurs in the prostate. B D Gleason pattern 3 to 5 respectively. A small probe about the size and shape of a cigar is inserted into your rectum. An illustration of the Gleason grading process for an example biopsy containing prostate cancer. So intermediate levels can be created by simply downsampling a higher resolution level. B Prostatic adenocarcinoma Gleason Pattern 3 has no loss of glandular differentiation. There is an attempt to form lumina but the tumor fails to form complete well developed glands. com gpreda panda challenge starting eda1. Biopsies can be in different rotations. Usually it grows slowly and is initially confined to the prostate gland where it may not cause serious harm. Checking of the Distribution of Data Provider ISUP Grade and Gleason Score Auxilary Function Summary of Counts Visualization Inferences on the Distributions About the Distribution of ISUP Grade Majority of data samples in train set have ISUP grade values 0 or 1 total 50. Loading of the Required DependenciesThis Python 3 environment associated with this notebook comes with many helpful analytics libraries installed. As explained in the overview on competition these markings are not part of the tissue but were made by the pathologists who originally checked this case. csv File Content Performing of Some Basic EDA Checking of the Size of Training label masks and Samples and InferenceAs we also highlighted early in the previous section the outputs of the cell above show that All the training images do not have masks as we can see that the training samples size is 10616 whereas the sample mask size is only 10516. However to get started we will first begin with a deep explanation of some key concepts related to Prostate Cancer and its detection and that we are worth knowing. This microphotograph shows irregular cribriform cancer i. As with the slides itself the label masks can be opened using OpenSlide. Now Let s Get Started with PANDA DatasetThis notebook shows few methods to load and preprocess WSIs from PANDA challenge dataset. though the lower part of the range isn t used as often. The appearance of the glands forms the basis of the Gleason grading system. Gleason Pattern 5 may also contain solid sheets or strands of cancer cells. Inspirational ReferencesThe following kernels were of great help in the creation of this notebook 1. Dispersed single cancer cells are seen in the stroma. Collecting a sample of prostate tissue If initial test results suggest prostate cancer your doctor may recommend a procedure to collect a sample of cells from your prostate prostate biopsy. gleason_score which is an alternate cancer severity rating system with more levels than the ISUP scale as you can see in the figure below depicting how Gleason score and ISUP grade systems compare. Let s Explore few of these Images with Pen Markers Distributions of the Dimensions width hight of Training Samples Extraction of Dimensions width hight and Merging with the Train Data Visualization of some Insighful Distributions Auxiliary Function Inferences on the DistributionsWe can see that overall as well as at ISUP Grade and Gleason Socre levels width and height have almost similar distribution. Checking of some Generalizable Properties on the Data Some Few InsightsThe outputs of the cell above show the properties of two WSIs from the 9 randomly selected training images from different data provider. Some of the training set images have stray pen marks on them but the test set slides are free of pen marks. com c prostate cancer grade assessment data https zenodo. OnpenSlide and merge them using PIL. com c prostate cancer grade assessment overview https www. On the other hand radbound is major data provider for 4 4 4 3 4 5 5 4 5 5 5 3 3 5. Domain Knowledge In this section we are interested in covering the knowledge around the Prostate Cancer in order to have a deeper understanding of the problem. Question 5 How have Gleason scores been generated in the dataset Each whole slide Image WSI in this challenge contains one or in some cases two thin tissue sections cut from a single biopsy sample. Deeper Exploratory Data Analysis of PANDA About the notebookIn this notebook we are basically going to dive deeper into the dataset explanation and build on that to perform an extensive EDA. Prostate biopsy is often done using a thin needle that s inserted into the prostate to collect tissue. Checking for the Relative Distributions RDs 1. The label information is stored in the red R channel the other channels are set to zero and can be ignored. And as you can observe on the figure below starting from x y 1024 1024 on some images a zomm of 512 times 512 doesn t capture the biopsy. these pen markings are available on some slides in the training set. Plotting of some Image and Masks According to sup_grade Category Auxiliary functions for this task Visualization Overlaying of Training Label Masks on their Corresponding Whole Slide ImagesGiven the knowledge of the importance of masks and also the fact that they have the same dimension as their corresponding slides we can overlay them on the tissue to directly see areas which are cancerous. The glands are grouped together. Each WSI has 3 levels that can be loaded corresponding to a downsampling of about 1 4 and 16 as shown in the output cell above. The patterns are described in detail below and exemplified in the figure below A Benign prostate glands with folded epithelium The cytoplasm is pale and the nuclei small and regular. Both libraries have some amazing and independent functions to process WSIs for example one of the key benefits of openslide is that we can load arbitrary regions of the slide without having to load the whole image into memory. This method returns a tuple of individual image bands from an image. If a DRE or PSA test detects an abnormality your doctor may recommend further tests to determine whether you have prostate cancer. In gleason_score category negative all the data is provided by radbound. This means there are exactly 100 training samples without that do not have a mask. tiff files can be in any of several classes including gray scale color palette or RGB full color. Dataset is not balanced in terms of gleason_score. OpenSlide and cv2. tiff Full file directory Openining without reading the image into memory Creation of the patch to plot Get the last level slide Get the dimension corresponding of the last level Resize the image patch Full file directory Openining without reading the image into memory Creation of the patch to plot Get the last level slide Get the dimension corresponding of the last level Resize the mask patch cmap mpl. Prostate specific antigen PSA test Here a blood sample is drawn from a vein in your arm and analyzed for PSA a substance that s naturally produced by your prostate gland. More precisely he feels the back wall of the prostate gland for enlargement tenderness lumps or hard spots. com kaggle docker python In the cell below we enable the several different and helpful packages modules libraries that I think are required for this project. Besside these WSI properties I associated a 512 times 512 zoomed part of the image around x y 1024 1024. The main domain knowledge info has been taken from the following sources https www. It s normal for a small amount of PSA to be in your bloodstream. The glandular structure characteristic of healthy prostate tissue is progressively lost with increasing grade. So we are going rearrange each training sample with its corresponding mask. Visualization Some Few InsightsAs you can observe on the outputs of the cell above overlaying mask on slide there are some few pen markings on the slide dark green smudges. All microphotographs show hematoxylin and eosin stains at 20x lens magnification. The label masks provided by Karolinska center were semi autotomatically generated based on annotations by a pathologist. Auxiliary functions for this tasksAfter creating the mask patch to visualize we will apply mask. org api python to read more about the OpenSlide Python. XxR 85MzZQL https emedicine. D Prostatic adenocarcinoma Gleason Pattern 5 has an almost complete loss of glandular differentiation. Biopsies not containing cancer are represented by an ISUP grade of 0 in this challenge. About the Output VariablesThe whole experiment of testing and detecting the Prostate Cancer outputs two varaibles that are isup_grade which is the target variable representing the severity of the cancer on a 0 5 scale. Checking Missing Information Checking of test. All of these are included in Gleason Pattern 4. Base on the challenge description the dataset consists of about 11 000 data samples for which each sample represents a whole slide image WSI of prostate biopsies from two sources Radboud University Medical Center https www. read_csv Plotly for the interactive viewer see last section fontsize of the figure title fontsize of the axes title fontsize of the x and y labels fontsize of the tick labels fontsize of the tick labels legend fontsize Input data files are available in the read only. If your doctor finds any abnormalities in the texture shape or size of the gland you may need further tests. The cytoplasm is often dark and the nuclei enlarged with dark chromatin and some prominent nucleoli. In isup_grade category 3 4 and 5 most of the data is provided by radbound. Loading of the Data Directories Exploration Note We can write up to 5GB to the current directory kaggle working that gets preserved as output when you create a version using Save Run All. The grading system recognizes three categories 3 4 and 5. Question 2 How is Prostate Cancer tested and detected Prostate Cancer is tested through some prostate screening tests that might include Digital rectal exam DRE During a DRE your doctor inserts a gloved lubricated finger into your rectum During a DRE your doctor inserts a gloved lubricated finger into your rectum to examine your prostate which is adjacent to the rectum as depicted in the figure below. A higher grade indicates a more aggressive cancer that is more likely to spread quickly. Here is how Radboudumc the prostate glands are individually labelled and the valid values are 0 background non tissue or unknown 1 stroma connective tissue non epithelium tissue 2 healthy benign epithelium 3 cancerous epithelium Gleason 3 4 cancerous epithelium Gleason 4 5 cancerous epithelium Gleason 5 Karolinska the regions are labelled and the valid values are 0 background non tissue or unknown 1 benign tissue stroma and epithelium combined 2 cancerous tissue stroma and epithelium combined The label masks provided by Radboudumc center were semi automatically generated by several deep learning algorithms contain noise and can be considered as weakly supervised labels. The label masks are stored in an RGB format so that they can be easily opened by image readers. resize can be used as well instead of openslide. Small glands infiltrate between benign glands. C Prostatic adenocarcinoma Gleason Pattern 4 has partial loss of glandular differentiation. The dimensions of each level differ based on the dimensions of the original image. Recall we showed early that there are exactly 100 training sample images whose the training label masks are not available in the mask directory. The importance of these masks is they directly indicate which parts of the tissue are healthy and which are cancerous. Dataset is not balanced in terms of isup_grade. com iamleonie panda eda visualizations suspicious data linear algebra data processing CSV file I O e. A laboratory pathologist examines a sample of your cancer to determine how much cancer cells differ from the healthy cells. com article 1612022 overview1. Prostate Cancer is one of the most common types of cancer in men. Loading and Quickly Displaying of some few WSIsLet s randomly select some few WSIs from the training samples and play with them to get some few insights. MultiImage and cv2. Some Advanced EDAIn this section we are going to load some few images samples from the training image directory and learn some of their properties. Prior to scanning the tissue is stained with haematoxylin eosin H E. tiff is a common format for exchanging raster graphics bitmap images between application programs including especially those used for scanner images. The tissue sample is analyzed in a lab to determine whether cancer cells are present. However if a higher than normal level is found it may indicate prostate infection inflammation enlargement or cancer. The probe uses sound waves to create a picture of your prostate gland. You can also write temporary files to kaggle temp but they won t be saved outside of the current session. Let s recall this is provided on training data only. For example splitting an RGB image creates three new images each containing a copy of one of the original bands channels red green blue. Click on OpenSlide Python Documentation https openslide. The loading and processing of these WSIs will be performed using both skimage and openslide libraries in Python. ", "id": "djeutsch/panda-deeper-eda-and-visualization-v2", "size": "20413", "language": "python", "html_url": "https://www.kaggle.com/code/djeutsch/panda-deeper-eda-and-visualization-v2", "git_url": "https://www.kaggle.com/code/djeutsch/panda-deeper-eda-and-visualization-v2", "script": "openslide IPython.display mask_on_slide_overlayer Image numpy seaborn ImageOps plot_WSIs distribution_plot glob load_and_resize_biopsy plot_distribution_grouped skimage.io matplotlib.pyplot plot_biopsy_masks PIL plotly.graph_objs pandas load_and_resize_biopsy_mask plot_resized_biopsy matplotlib display HTML ", "entities": "(('when you', 'Save Run'), 'write') (('loading', 'openslide Python'), 'perform') (('sample mask size', 'training samples'), 'have') (('score', 'figure'), 'gleason_score') (('grade', 'prostate cancer cells'), 'call') (('you', 'pen some few slide dark green smudges'), 'visualization') (('However information', 'two centers'), 'differ') (('B', 'glandular differentiation'), 'have') (('doctor', 'prostate prostate biopsy'), 'recommend') (('So we', 'corresponding mask'), 'go') (('domain knowledge main info', 'sources https following www'), 'take') (('you', 'prostate cancer'), 'detect') (('almost slides', 'label additional information'), 'have') (('hollow which', 'branched WSI'), 'be') (('Dataset', 'gleason_score'), 'balance') (('we', 'OS'), 'load') (('It', 'kaggle python Docker image https github'), 'define') (('that', 'tissue'), 'do') (('tumor', 'complete well developed glands'), 'be') (('Checking', 'Relative Distributions'), 'RDs') (('I', 'index'), 'list') (('probe', 'prostate gland'), 'use') (('only how biopsy', 'lab'), 'have') (('we', 'problem'), 'knowledge') (('Loading', 'Corresponding Masks'), 'prepare') (('Some InsightsThe outputs', 'data different provider'), 'check') (('appearance', 'Gleason grading system'), 'form') (('you', 'growth different patterns'), 'help') (('we', 'memory'), 'have') (('Loading', 'analytics many helpful libraries'), 'come') (('we', '0 competition'), 'question') (('image dimensions', 'x'), 'be') (('D Prostatic adenocarcinoma', 'glandular differentiation'), 'have') (('other channels', 'zero'), 'store') (('So intermediate levels', 'resolution simply higher level'), 'create') (('Prostate Cancer', 'men'), 'be') (('Checking', 'ISUP grade values'), 'have') (('times 512 doesn', 'biopsy'), 'observe') (('cancer how much cells', 'healthy cells'), 'examine') (('more others', '5 very dataset'), 'be') (('microphotograph', 'cribriform cancer irregular i.'), 'show') (('cancer cells', 'lab'), 'analyze') (('each', 'bands original channels'), 'create') (('I', 'project'), 'python') (('Dataset', 'isup_grade'), 'balance') (('this', 'training data'), 'let') (('level last slide', 'mask patch cmap mpl'), 'directory') (('that', 'figure'), 'be') (('former', 'following packages'), 'resize') (('grading system', 'three categories'), 'recognize') (('structure glandular characteristic', 'progressively increasing grade'), 'lose') (('small probe', 'rectum'), 'insert') (('doctor', 'further prostate'), 'include') (('split that', 'bands individual channels'), 'function') (('C Prostatic adenocarcinoma', 'glandular differentiation'), 'have') (('data', 'radbound'), 'provide') (('Input data files', 'read'), 'see') (('0 0 data', 'karolinska'), 'about') (('Small glands', 'benign glands'), 'infiltrate') (('Gleason Pattern', 'cancer cells'), 'contain') (('label masks', 'pathologist'), 'generate') (('epithelial unit', 'lumen'), 'be') (('microphotographs', '20x lens magnification'), 'show') (('cytoplasm', 'often dark chromatin'), 'be') (('training sample training label early exactly 100 masks', 'mask directory'), 'show') (('that', 'naturally prostate gland'), 'draw') (('cytoplasm', 'folded epithelium'), 'describe') (('dimensions', 'original image'), 'differ') (('it', 'prostate infection inflammation enlargement'), 'find') (('who', 'originally case'), 'be') (('4 most', 'radbound'), 'provide') (('that', 'train'), 'notice') (('overlayed image', 'memory'), 'Open') (('competition organizers', 'training set'), 'be') (('which', 'Urological Pathology'), 'pattern') (('tiff files', 'scale color gray palette'), 'be') (('test set slides', 'pen marks'), 'have') (('More precisely he', 'enlargement tenderness lumps'), 'feel') (('you', 'further tests'), 'need') (('sample mask size', 'masks'), 'Performing') (('gleason_score distribution', 'graph'), 'be') (('which', '0 5 scale'), 'about') (('Inspirational ReferencesThe following kernels', 'notebook'), 'be') (('Loading', 'few insights'), 'select') (('sample', 'two sources'), 'consist') (('All', 'Gleason Pattern'), 'include') (('they', 'image easily readers'), 'store') (('small amount', 'bloodstream'), 's') (('tissue tissue label 0 background non tissue unknown 1 benign epithelium combined 2 cancerous masks', 'weakly supervised labels'), 'be') (('even other types', 'slowly minimal'), 'be') (('next step', 'cancer cells'), 'question') (('0 1 most', 'karolinska'), 'Score') (('tiff', 'scanner images'), 'be') (('tissue two thin sections', 'biopsy single sample'), 'question') (('method', 'image'), 'return') (('slide whole WSIs', 'Tag Image File Format'), 'be') (('we', 'mask'), 'apply') (('this', 'laboratory different procedures'), 'be') (('3 3 karolinska', 'gleason_score Also category'), 'be') (('how much cancer', 'healthy tissue lower score'), 'combine') (('This', 'mask'), 'mean') (('which', 'figure'), 'question') (('which', 'tissue'), 'be') (('cancer Dispersed single cells', 'stroma'), 'see') (('Gleason levels width', 'almost similar distribution'), 'let') (('samples', 'glandular tissue'), 'make') (('that', 'more aggressive cancer'), 'indicate') (('section we', 'properties'), 'go') (('Biopsies', 'challenge'), 'represent') (('label masks', 'OpenSlide'), 'open') (('we', 'Prostate Cancer'), 'begin') (('I', 'image'), 'besside') (('that', 'output cell'), 'have') (('notebook', 'PANDA challenge dataset'), 'let') (('all', '11 12'), 'associate') (('where it', 'serious harm'), 'grow') (('notebook we', 'extensive EDA'), 'Analysis') (('that', 'prostate'), 'go') (('pen markings', 'training set'), 'be') (('which', 'directly areas'), 'plot') (('t', 'outside current session'), 'write') (('This', 'contrast'), 'be') "}