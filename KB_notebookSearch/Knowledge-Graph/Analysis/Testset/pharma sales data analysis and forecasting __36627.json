{"name": "pharma sales data analysis and forecasting ", "full_name": " h1 Case study univariate time series analysis and forecasting of pharmaceutical products sales data at small scale h1 1 Introduction h1 2 Theoretical background h2 2 1 Time series forecasting h3 2 1 1 ARIMA method h3 2 1 2 Prophet method h3 2 1 3 Neural networks h1 3 Methodology h1 4 Solution discussion h2 4 1 Feature engineering and data preparation h2 4 2 Time series analysis h3 4 2 1 Seasonality analysis h3 4 2 2 Stationarity analysis h3 4 2 3 Regularity analysis h3 4 2 4 Autocorrelation analysis h3 4 2 5 Data distribution analysis h2 4 3 Time series forecasting h3 4 3 1 Baseline forecasting accuracy h4 4 3 1 1 Na\u00efve forecasting h4 4 3 1 2 Average method forecasting h4 4 3 1 3 Seasonal Na\u00efve forecasting h3 4 3 2 ARIMA Forecasting h4 4 3 2 1 Choosing parameters for ARIMA model h4 4 3 2 2 Rolling forecasting with ARIMA model h4 4 3 2 3 Long term forecasting with ARIMA model h4 4 3 2 4 Rolling forecasting with Auto ARIMA model h4 4 3 2 5 Long term forecasting with Auto ARIMA model h3 4 3 3 Prophet forecasting h4 4 3 3 1 Grid search optimization of Prophet hyper parameters h4 4 3 3 2 Rolling forecasts with Prophet h4 4 3 3 3 Long term forecasting with Prophet h3 4 3 4 Forecasting with LSTM h4 4 3 4 1 Long term forecasting with Vanilla LSTM configuration h4 4 3 4 2 Long term forecasting with Stacked LSTM model h4 4 3 4 3 Long term forecasting with Bidirectional LSTM h1 5 Conclusion ", "stargazers_count": 0, "forks_count": 0, "description": "trend long term increasing or decreasing value in series 3. Each of the method is complemented with two optimization and validation approaches relevant for short term so called rolling forecast scenario and long term forecasting. Some rules for defining the initial set of parameters often used in a literature are as follows m is equal to the ACF lag with the highest value typically at a high lag. Hyper parameters were optimized by using three approaches manually with ACF PACF plot analysis Python s statsmodels function and grid search optimization. Research work behind the paper considers 8 time series with different statistical features. The data preparation process for LSTM included transforming to stationary time series sequencing time series to supervised problem data shape Xt n_steps. While SARIMA facilitates direct modeling of the seasonal component of time series by considering its own lag order differencing degree MA order and an actual lag SARIMAX provides the extension for using exogenous variables and thus enable multivariate time series forecasting. The main problem in smaller scale time series analyses and forecasts are significant uncertainties and sales performance very close to random making the forecasts with accuracies above thresholds as defined by Na\u00efve methods difficult to achieve. Autocorrelation plots graphically summarize the strength of a relationship of an observation in a time series with observations at prior time steps with respect to the confidence interval typically 95 of confidence. For additive series time dependent variable value is equal to the addition of four components namely y t Level Trend Seasonality NoiseIn multiplicative series changes increase or decrease over time y t Level Trend Seasonality NoiseEach time series can be decomposed to its four components by using different methods such as Na\u00efve Loess or STL. D Seasonal difference order. Some common rules for choosing d are Rule 1 If the series has positive autocorrelations out to a high number of lags then it probably needs a higher order of differencing. N02BE and N05B charts though showing the similar trends are suppresed because of the larger scale which makes the other illustrations less readable. Q Seasonal moving average order. Seasonal Na\u00efve forecasting 4. In other words how much can the changepoints fit to the data. Relu activation function was used optimizer was Adam and loss function was Mean Squared Error. Forecasts have proven better than Na\u00efve methods and in acceptable intervals for long term planning. For long term forecasting Prophet and LSTM models have shown significantly better performance then benchmarks in the time series with seasonality. If high it will be more flexible but then overfitting is possible. 249 in the series were stationary with maximum confidence. Mean squared error is used instead. Approximate or Sample Entropy methods can be used to quantify the regularity and predictability of fluctuations in a time series. In this research three different LSTM architectures were used. Similar to downsampling rolling windows split the data into time windows and the data in each window is aggregated with a function such as mean median sum etc. All MSE metrics will be stored in a dataframe which will be later use for presentation of the overall results and comparison. It is integrated I namely it uses differencing see above to make time series stationary within the method. Optimal sets of hyper parameters are then used also for rolling forecasts. Prophet model is tuned by using the following hyper parameters growth. Two different approaches to forecasting problem scoping were adopted. Three LSTM architectures were tested Vanilla LSTM Stacked LSTM and Bidirectional LSTM. Time series analysis had two fold objective. Long term forecasting with Vanilla LSTM configuration 4. Although this model fails when the market saturates in general and on a larger scale it has proven as successful. MSE was used as metrics for comparing the performance and also as a loss function for LSTM. Grid search optimization is carried out for both approaches in forecasting rolling and long term. This plot is sometimes called a correlogram or an autocorrelation plot. National holidays as non working days with seasonal patterns similar to Sundays are expected to disrupt daily sales. Rolling forecasting with ARIMA model 4. However AIC is not used to score accuracy of the forecasting methods in this research. Daily weekly and annual seasonality analysis were proven useful for identifying the periods in which special sales and marketing campaigns could be implemented except for N05B and N05C categories of drugs which did not exhibit significant regularities. changepoint_prior_scale is there to indicate how flexible the changepoints are allowed to be. exploratory data analysis time series analysis and 3. The model facilitates easy customization and reliable forecasts with default configurations. Effectiveness of three forecasting methods namely ARIMA Facebook s Prophet and Long Short Term Memory LSTM neural networks was investigated. Trends and seasonality can be explored in time series decomposition view based on 30d rolling means. 05 the null hypothesis is rejected and series is considered as stationary. seasonality_prior_scale parameter. \u03b1 1 \u03b1 not n with 0 \u03b1 1. Grid search optimization for rolling forecast produced the following best combinations of the hyper parameters Grid search optimization for long term forecast produced the following best combinations of the hyper parameters From the optimization stand of point some series are considered as so called white noise random time series data. A plot of the autocorrelation of a time series by lag is called the AutoCorrelation Function ACF. Forecasting with LSTMLong term forecasting validation has been done with three LSTM configurations Vanilla LSTM Stacked LSTM and Bi directional LSTM. Components required for forecasting with LSTM are then imported. Another approach is related to long term forecasting for example forecasting the future period of one year by using the model trained with historical data. Finally data is then rescaled to weekly time series and stored. ARIMA methodARIMA Auto Regressive Integrated Moving Average models are most commonly used tools for forecasting univariate stationary time series. Choosing parameters for ARIMA modelFirst method arma_order_select_ic was used to determine initial p and q parameters. In general the partial correlation between two variables is the amount of correlation between them which is not explained by their mutual correlations with a specified set of other variables. Before each forecast is made the process of optimizing hyper parameters p d q of ARIMA model was carry out. If the data series is stationary d 0. Seasonal decomposition can be also used for forecasting by building the model by using any other approach on the time series data with subtracted residual component as calculated by any of the decomposition methods such as STL. changepoint_range usually does not have that much of an effect on the performance. Solution discussionSolution will be using the set of Python libraries namely numpy for computational tasks pandas for data structures matplotlib for plotting and others libraries used for forecasting with LSTM are imported later. The changepoints parameter is used when the changepoint dates are supplied instead of having Prophet determine them. Stationarity analysisStationarity of time series is the property of exhibiting constant statistical properties over time for example mean variance autocorrelation. Sales of antirheumatic drugs in M01AB and M01AE categories could be affected by the changes of atmospheric pressure. Sales spikes are visible at the dates of state pensions payoff. First annual weekly and daily data analysis were done with objective to make potentially useful conclusions and propositions for improving sales and marketing strategies. This paper is structured into 4 main parts. Therefore during testing prediction in a timestep t is based on the model which fits the training set consisting of observations in timesteps 0 t 1 or f t f o 0 t 1. Seasonality is clearly confirmed for the categories of R03 R06 and N02BE. Grid search was used as adopted approach for hyper parameters optimization for ARIMA and Prophet model. In stationary time series the mean of the series variance of the series and covariance of the i th term and the i m th term should not be a function of time. Those are series for whom the best result was achieved with p 0 d 0 and q 0. Then research methodology actually a problem neutral time series forecasting pipeline is presented. Long term forecasting with ARIMA model 4. Function split_sequence for transforming time series data to data for supervised machine learning problem is provided including constants such as number of previous steps to take into account. Kwiatkowski Phillips Schmidt Shin KPSS test found the trend non stationarity in N02BE R03 and R06. The higher the entropies are the more difficult is to forecast the time series. Model uses the dependency relationship correlation between an observation and some number of lagged observations AR in the past. Basic time series forecasting assumes regressing the observation at the time t on the observations in the previous time steps ft e1ot 1 e2ot 2 enot n. Some weekly seasonality is visible. An easy way to visualize these trends is with rolling means at larger time scales. For all series entropy values were higher than 1 indicating low predictability with highest values for M01AE M01AB and N02BA. Q 1 if the ACF is negative at lag S else Q 0. Seasonality analysisThe seasonality patterns can be explored in detail by using boxplots. To some extent the proportion of the residuals when comparing with trend and seasonality can be also illustrated by the rolling means and standard deviation plots above. Besides p d q parameters of ARIMA SARIMA also considers additional parameters P D Q m P Seasonal autoregressive order. Xt 2 Xt 1 yt after determining input vector dimension which gives best accuracies and time series scaling normalization or standardization. Analysis below shows 30 day and 365 day rolling mean and 30 day rolling standard deviation of sales data. According to the authors Prophet is successful for forecasting data with strong human scale seasonality day of week time of year reasonable number of missing data and or outliers historical trend changes non linear trends with saturation at least one year of observations known holidays. Rolling forecast model can be used for short term resource planning and planning the procurement of stock of pharmaceutical products. Image below shows trends for each of the drug categories represented by the 365 d rolling means for each of those categories. A new global Tensorflow session is configured. Stacked LSTM is architecture with two or more hidden layers of LSTM units stacked one on top of another. The method computes Akaike s Information Criterion AIC for many ARIMA models and chooses the best configuration. D 1 if the series has a stable seasonal pattern over time. No optimization of hyper parameters was carried out. Neural networks Long Short Term Memory LSTM are a form of Recurrent Neural Networks RNN deep learning architectures that are characterized by the use of LSTM units in hidden layers. Rule of thumb P Q 2 2. level mean of time series data 2. First one implements so called rolling forecast namely forecasting the sales in the next week by using the model trained with all historical data. Long term forecasting with Auto ARIMA model 4. Prophet forecasting Prophet model is fited with data in two columns where first one contains time information and is labeled as ds. Another stores actual time series data and is labeled as y. Na\u00efve forecasts are considered optimal when data follow a random walk and they can be used only in walk forward or rolling forecasts not in long term forecasting. Prophet model is tuned by using the following hyper parameters only selected parameters are noted growth. Function seasonal_decompose can be used for analysis of the portions of each component of time series. Case study univariate time series analysis and forecasting of pharmaceutical products sales data at small scaleThe objective of the research behind the paper was to validate different methods and approaches related to sales time series data preparation analysis and forecasting with aim to facilitate recommending sales and marketing strategies based on trend seasonality effects and forecasting sales of eight different groups of pharmaceutical products with diverse characteristics such as stationarity seasonality amount of residuals and sales data variance. IntroductionOn a larger scale the sales forecasting in pharmaceutical industry is typically done by using Na\u00efve model where the forecasted values equal values in the previous period with added factor of growth which is specifically defined for different regions markets categories of products etc. guide very important decisions related to resource and procurement planning what if analyses return on investment forecasting business planning and others. Here the forecast is equal to a weighted average of the past observations where weights decrease exponentially as we go back in time. This intermediary series is used for the formal definition of anomalies and their identification. Feature engineering and data preparation Initial dataset consisted of 600000 transactional data collected in 6 years period 2014 2019 indicating date and time of sale pharmaceutical drug brand name and sold quantity. Long term forecasting with Stacked LSTM model 4. These plots are often called Autocorrelation Function ACF plots or correlograms. Chart with weekly sales for different categories of interest was shown below. Minor autocorrelation is observed at ACF Auto Correlation Function and PACF Partial Auto Correlation Function plots for all series with exception of N05C sales. Time series forecasting Forecasting models were fitted with weekly time series data with dataset of 302 rows. ARIMA Forecasting ARIMA method was used to to carry out short term rolling forecast and long term forecasting based on test data. Time series forecastingThere are many different methods and approaches to time series forecasting. Thus selected group of drugs 57 drugs is classified to 8 Anatomical Therapeutic Chemical ATC Classification System categories M01AB Anti inflammatory and antirheumatic products non steroids Acetic acid derivatives and related substances M01AE Anti inflammatory and antirheumatic products non steroids Propionic acid derivatives N02BA Other analgesics and antipyretics Salicylic acid and derivatives N02BE B Other analgesics and antipyretics Pyrazolones and Anilides N05B Psycholeptics drugs Anxiolytic drugs N05C Psycholeptics drugs Hypnotics and sedatives drugs R03 Drugs for obstructive airway diseases R06 Antihistamines for systemic useATC codes features are added to the dataset namely a model has been transformed as indicated on the image below and data was resampled to the hourly time series. Grid search optimization of Prophet hyper parametersBefore actual forecasting the optimal set of hyper parameters is determined by using grid search method. Decomposition is especially useful for trend and uncertainty variance of residuals typically corresponds to randomness analysis. the number of Fourier components each seasonality is composed of. Then stationarity autocorrelation and predictability analysis of the time series in individual groups was analyzed to infer the initial set of parameters for implementing the forecasting methods. Robert Nau Statistical Forecasting Method is improved with SARIMA Seasonal ARIMA SARIMAX Python implementation was used. In practice Prophet should be let to do that alone. Feature engineering and data cleaning including strategies for detecting outliers and their treatment code is ommited in this notebook because of the confidentiality issues. Thus the following analysis is relevant only for data with normal Gaussian distribution. In order to get reproducible results in forecasting with LSTM following values are fixed seed value PYTHONHASHSEED environment variable Python s numpy s and Tensorflow s built in pseudo random generators. PACF plots highlight autocorrelation between observation ot and prior observations oi without taking into account correlations in the time steps in the interval t i. This is especially useful when determining uptake of residuals in data based on the decomposed data. Three forecasting methods were tested ARIMA Prophet and LSTM. All methods in all cases with exception of Prophet N02BE outperform reference benchmarks Naive and Seasonal Naive forecasts. In all cases even without optimization LSTM models have achieved competitive performance. There are also improved SES methods which consider trends and seasonality. D 0 if the series has an unstable seasonal pattern over time. To conclude time series analyses and forecasts have guided potentially useful conclusions and recommendations to the pharmacy. However key improvements in sales forecasting are expected from reducing the uncertainty of the models by expanding to multivariate time series forecasting problem as explained above. Stationarity of time series is the property of exhibiting constant statistical properties over time for example mean variance autocorrelation. KPSS is used to test for trend stationarity. Another useful tool for determining autocorrelation are Partial Autocorrelation Function PACF plots. First Na\u00efve forecasting was done and results presented. In order to get comparable results pseudo random generators of Python Numpy and Tensorflow were set to fixed values. Finally the discussion brings the description of actual results and some suggestions to the sales department driven by the result of the data analysis. P 1 if the ACF is positive at lag S else P 0. Number of past observations tested in input sequences was either 10 or 5. Long term forecasting with Bidirectional LSTM 5. Autocorrelation analysisAutocorrelation analysis illustrates the potential for time series data prediction. In specific we benchmark the accuracies achieved with those methods against the performances of basic Na\u00efve Seasonal Na\u00efve and Average methods. seasonality the repeating short term cycle in the series and 4. Mean Absolute Percentage Error MAPE was provided only as an illustration because data on different groups of pharmaceutical products were on significantly diverse scales. Baseline accuracy was calculated by using Na\u00efve and Seasonal Na\u00efve for rolling forecasts and Average method for long term ones. Average method was used as a baseline for long term forecasting while Na\u00efve and Seasonal Na\u00efve were used for rolling forecasts. Following transforms for stationarizing data for methods which do not work well with non stationary data for example ARIMA are available 1 de trending removing the underlying trend in the series 2 differencing seasonal or cyclic patterns are removed by subtracting periodical values 3 logging linearizing trend with exponential function. m of 12 for monthly data suggests a yearly seasonal cycle. Train test split method was used 52 weeks of test data. m The number of time steps for a single seasonal period. Regularity analysisFor calculating regularity and predictability of time series Approximate Entropy test was used. Rolling window operations are another important transformation for time series data. N02BE R03 and R06 series were found to exhibit annual seasonality. Typically it is equal to the lag at which PACF cuts off the cone of the confidence interval d differencing degree number of times that the raw observations are differenced. Each of the time series summarizes sales of a group of pharmaceutical products. Typically a time series data embodies each of the four different components 1. For Na\u00efve forecasts all forecasts are set to be values of the last observation or ft 1 ot. While Prophet model is used both for rolling forecasts and long term forecasting optimization of hyper parameters is carried out only for long term forecasts. In Average method the forecasts of all future values are equal to mean of the historical data. LSTM was applied only for long term forecasting. It can be visually determined by plotting rolling statistics rolling means and variances. Longterm forecasting will be carried out by using 7 methods Average ARIMA AutoARIMA Prophet Vanilla LSTM Stacked LSTM Bidirectional LSTM. Before fitting all data was standardized rescaled in interval 1 1 and transformed to data for supervised problem. If the ACF of the differenced series displays a sharp cutoff and or the lag 1 autocorrelation is negative then non zero MA factor should be added to the model. Long term forecasts validation is based on MSE of one year forecast compared to actual observations. Dates of the pension payoff. If the dataset is split to train and test sets then Average of training set is used as a forecast. ADF test assumes that the null hypothesis is the time series possesses unit root and is non stationary. All warnings will be supressed for the cleaner presentation of this notebook this is a bad practice note that all presented code was tested. Finally it uses the dependency between an observation and a residual error from a moving average model applied to lagged observations MA. Forecasting results are validated by using two approaches short term and long term forecasts. Rolling forecasting will be carried out by using 5 methods Naive Seasonal Naive ARIMA AutoARIMA Prophet. Train test split validation with one last year of data 52 rows was used for testing. Key performance indicator for forecasting accuracies in both approaches was Mean Squared Error MSE. Na\u00efve forecasting 4. Introducing this feature may facilitate what if forecasting analysis of sales performance during marketing campaigns involving price reductions. Average method forecasting 4. The best results were achieved with training the model in 400 epochs. In order to define the baseline forecasting accuracy to improve from three tests were performed. The lag at which the PACF cuts off is the indicated value of p. Main feature of RNNs is that they allow information to persist or they can inform the decision on some classification or regression task in the moment t by using observations or decisions at moments t 1 t 2. Rule 2 If the lag 1 autocorrelation is zero or negative or the autocorrelations are all small and random then the series does not need a higher order of differencing. In the remainder of this notebook final datasets will be used. Rolling forecasting with Auto ARIMA model 4. Also info messages are supressed for the same reason. In case that time series is non stationary it needs to be transformed. Three different models were tested ARIMA SARIMA for rolling and long term forecast Facebook s Prophet for rolling and long term forecast and Long Short Term Memory LSTM artificial neural network architectures for long term forecast. We can use Augmented Dickey Fuller ADF test to check stationarity of the data. For example if we are regressing a variable Y on other variables X1 X2 and X3 the partial correlation between Y and X3 is the amount of correlation between Y and X3 that is not explained by their common correlations with X1 and X2. Time series analysis Time Series Analysis included seasonality stationarity autocorrelation regularity and data distribution analysis. Long term forecasting with Prophet 4. The main research question we tackle is related to exploring the feasibility of use of modern time series forecasting methods in pharmaceutical products sales forecasting on a smaller scale. Another quite successful classical forecasting method is Simple Exponential Smoothing SES where forecasts are calculated as ot 1 \u03b1ot \u03b1 1 \u03b1 ot 1 \u03b1 1 \u03b1 2ot 2. Finally seasonal Na\u00efve forecast was carried out for the series that has been found as seasonal N02BE R03 and R06. Seasonal Na\u00efve method is useful for time series that show seasonality effects. This model can be used for business planning and making decisions of strategic nature. However unlike downsampling where the time bins do not overlap and the output is at a lower frequency than the input rolling windows overlap and roll along at the same frequency as the data so the transformed time series is at the same frequency as the original time series. One series is considered trend stationary if after removing the underlying trend series becomes stationary. In bidirectional LSTM architecture model learns the input sequences both forward and backward. See Theoretical background section for explanation of those methods. Next the actual implementation is presented by highlighting the steps made in following the proposed methodology in the case of pharmaceutical products sales data analysis and forecasting. ConclusionFor rolling forecast ARIMA method Auto ARIMA for series with seasonal character outperforms Prophet and is considered as a best candidate for short term sales forecasting. Below boxplots on a weekly scale are shown for the purpose of exploring the weakly seasonality. noise or residuals random variations in the series. In latter case the cap maximum value data will reach and floor minimum value data will reach of predictions need to be provided. That means also that the curve is smoother. This parameter will again allow your seasonalities to be more flexible. Time series data often exhibit some slow gradual variability in addition to higher frequency variability such as seasonality and noise. Then with optimal set of parameters rolling forecast and long term forecasting was carried out. the uncertainty interval to produce a confidence interval around the forecast. Seasonal ARIMA SARIMA method was tested by using Auto ARIMA implementation. First short theoretical background for time series analysis and forecasting is provided to inform the reader on the credibility of decisions made in the implementation of this case study. Pearson coefficient is used to measure autocorrelation. Forecasting was carried out at the weekly scale. For that reason grid search optimization method was applied where different combinations of the hyper parameters were used to calculate MSE and then the combination producing the least MSE was chosen as optimal. This is the parameter that has been adopted. NOTE this is illustrative example actual optimization is carried out with larger intervals of hyper parameters values. If the P Value of ADF test is less than 0. This implementation has built in stepwise optimizer which chooses optimal set of parameters p d q for non seasonal and p d q P D Q for seasonal series namely N02BE R03 and R06. For series with larger variances and randomness N05B and N05C and simpler Vanilla LSTM model 10 past observations produced better forecasting accuracy. The simplest methods which are typically used for determining baseline forecasting performance are Average Na\u00efve and Seasonal Na\u00efve those models are often used as benchmark models. One time series can be assumed to be additive or multiplicative although in a real world series that fit one or another model rarely exist. Possible values of regression parameters of ADF are c constant only default ct constant and trend ctt constant and linear and quadratic trend nc no constant no trendAugmented Dickey Fuller ADF test have shown that all data but N02BA P value 0. Typically Pearson coefficient of correlation is used meaning that linear correlation is assessed. Data distribution analysisChart with daily sales for different categories of interest is shown below. q moving average order size of the moving average window. Rolling forecasts with Prophet 4. This is typically determined by domain experts. In latter case the cap maximum value data will reach and floor minimum value data will reach of your predictions need to be provided. 5 or more negative the series may be overdifferenced. Time series data are collected from the Point of Sale system of a single pharmacy in period of 6 years. The lag at which the ACF cuts off is the indicated value of q. Prophet methodProphet is Facebook s additive regression model that includes linear or logistic trend yearly seasonal component modeled using Fourier series and user provided list of important holidays. As a result of the interviews with pharmacists decision was made that the subject of analyses and forecasting will be actual drug categories instead of the individual drugs. Some additional conclusions R03 and N05C has more outliers that the others indicating that their sales is more difficult to predict. Sales spikes may be explained by the discounts applied in a short term. Confidence intervals are drawn as a cone. Also outliers are detected in consultation with pharmacy staff and treated by first imputing the missing data and then by imputing representative data by using several methods. MethodologyThe methodology for implementing this case study follows the typical time series forecasting pipeline consisting of three major phases 1. feature engineering and data preparation 2. Sudden declines in all categories could be explained by extreme weather conditions such as heavy rain thunderstorms and blizzards. As difficulty increases the time series converge to what is called white noise series of random numbers with mean equals 0. Each forecast is set to be equal to the mean of the observed values from the same time in previous seasonal cycles. All these analyses and forecasts are made on a small scale for a single distributor pharmacy chain or even individual pharmacy. For a linear trending value should be linear. Vanilla LSTM is made of a single hidden layer of LSTM units and an output layer used to make a prediction. Second average method was used to forecast. It is important to note that AIC tend not to be a good guide to selecting the appropriate order of differencing d of a model but only for selecting the values of p and q. In all other cases 5 past observations were used. Future work on univariate time series forecasting includes increasing the number of data exploring different other accuracy metrics optimization of hyper parameters for LSTM models and testing other architectures such as CNN LSTM and ConvLSTM. Still analysis and forecasts on a smaller scale such as single distributor pharmacy chain or even individual pharmacy smaller periods such as weeks etc. By default this is set to a 95 confidence interval suggesting that correlation values outside of this code are very likely a correlation. Finally pyramid arima package will be installed in order to use Auto ARIMA method. Some common rules for choosing initial AR and MA values p q found in the literature are If the PACF of the differenced series displays a sharp cutoff and or the lag 1 autocorrelation is positive then non zero AR factor should be added to the model. Theoretical backgroundTime series is a sequence of observations recorded at regular time intervals hourly daily weekly monthly quarterly and yearly. Based on the problem and objective formal definition the data acquired from the sales information system are cleaned feature engineering approach was defined and all data are transformed to hourly time series consisting of aggregate sales among different classes of pharmaceutical products in hourly time periods namely anti inflammatory and antirheumatic products M01AB M01AE analgesics and antipyretics N02BA N02BE psycholeptics drugs N05B N05C drugs for obstructive airway diseases R03 and antihistamines for systemic use R06. For short term forecasts or so called rolling forecast validation or walk forward model validation train test split validation is performed in iterative fashion where observations are added to the training dataset after every individual weekly sales prediction while the model is fitted in each iteration. Plot shows the lag value along the x axis and the correlation on the y axis between 1 and 1. The volume of this uptake implies the predictability of the time series higher the residuals lower the predictability. Mean Absolute Percentage Error MAPE is also measured for each of the scenarios. Paper presents only research work related to univariate time series analysis while potential candidates for explanatory input variables were also identified and shortly elaborated. It is highly likely that the forecasts could be significantly improved by expanding the problem scope to multivariate time series forecasting and by including explanatory variables such as Weather data. Hyperparameters of one ARIMA model are p lag order number of observations in prior time steps included in the model. Baseline forecasting accuracyIn this subsection three summaries of the reference benchmarks namely Na\u00efve methods are provided. Its analysis involves understanding various aspects of the time series important for creating meaningful and accurate forecasts. The potential strength of time series prediction models is determined by autocorrelation correlation between what is considered as output variable Ot and input variables prior observations. If the lag 1 autocorrelation is 0. Another visualization that can be useful for discovering seasonality patterns is related to rolling window means. Autocorrelation plots graphically summarize the strength of a relationship with an observation in a time series with observations at prior time steps. It can be visually determined by plotting rolling statistics rolling means and variances or by using Augmented Dickey Fuller ADF or Kwiatkowski Phillips Schmidt Shin KPSS test. ", "id": "milanzdravkovic/pharma-sales-data-analysis-and-forecasting", "size": "36627", "language": "python", "html_url": "https://www.kaggle.com/code/milanzdravkovic/pharma-sales-data-analysis-and-forecasting", "git_url": "https://www.kaggle.com/code/milanzdravkovic/pharma-sales-data-analysis-and-forecasting", "script": "concat sklearn.metrics display adfuller Bidirectional keras.layers evaluate_arima_model plot_pacf auto_arima split_sequence statsmodels.tsa.arima_model plot_acf Sequential LSTM MinMaxScaler pyramid.arima mean_squared_error seaborn numpy array HTML ApEn statsmodels.tsa.stattools seasonal_decompose sklearn.model_selection matplotlib.pyplot Dense tensorflow pandas kpss statsmodels.graphics.tsaplots _maxdist ARIMA statsmodels.tsa.seasonal mean_absolute_percentage_error mean_absolute_error _phi sklearn.preprocessing keras.models evaluate_models ParameterGrid IPython.display statsmodels.api ", "entities": "(('ARIMA Forecasting ARIMA method', 'term test long data'), 'use') (('time series forecasting neutral pipeline', 'actually problem'), 'present') (('Prophet', 'seasonality'), 'show') (('Minor autocorrelation', 'N05C sales'), 'observe') (('Level Trend Seasonality NoiseEach time t series', 'Na\u00efve such Loess'), 'be') (('work', 'CNN such LSTM'), 'include') (('data', 'significantly diverse scales'), 'provide') (('MSE', 'LSTM'), 'use') (('actual optimal set', 'grid search method'), 'forecast') (('Na\u00efve', 'Seasonal rolling forecasts'), 'use') (('Time series analysis Time Series Analysis', 'seasonality stationarity distribution autocorrelation regularity analysis'), 'include') (('AR then non zero factor', 'model'), 'be') (('Time series', '302 rows'), 'fit') (('best results', '400 epochs'), 'achieve') (('time series Basic forecasting', 'enot ft e1ot 1 e2ot 2 n.'), 'assume') (('This', 'domain typically experts'), 'determine') (('potential candidates', 'input explanatory variables'), 'present') (('highly forecasts', 'Weather such data'), 'be') (('Longterm forecasting', '7 methods'), 'carry') (('However AIC', 'research'), 'use') (('psycholeptics drugs', 'use systemic R06'), 'clean') (('window Rolling operations', 'time series important data'), 'be') (('Stationarity', 'variance mean autocorrelation'), 'be') (('optimization', 'hyper parameters'), 'carry') (('forecasts', 'last observation'), 'set') (('what', 'price reductions'), 'facilitate') (('Sudden declines', 'rain such heavy thunderstorms'), 'explain') (('Auto Integrated Moving ARIMA Regressive Average models', 'time univariate stationary series'), 'use') (('PACF', 'indicated p.'), 'be') (('We', 'data'), 'use') (('ADF test null hypothesis', 'time series unit root'), 'assume') (('that', 'N02BE seasonal R03'), 'carry') (('2 seasonal patterns', 'exponential function'), 'follow') (('analysis', 'important meaningful forecasts'), 'involve') (('Time series analysis', 'two fold objective'), 'have') (('forecast Rolling model', 'pharmaceutical products'), 'use') (('Autocorrelation analysisAutocorrelation analysis', 'time series data prediction'), 'illustrate') (('which', 'significant regularities'), 'prove') (('MA then zero factor', 'model'), 'add') (('Time series data', 'such seasonality'), 'exhibit') (('Forecasts', 'term long planning'), 'prove') (('below data', 'time hourly series'), 'classify') (('time above series', 'method'), 'integrate') (('non it', 'case'), 'in') (('boxplots', 'weakly seasonality'), 'show') (('MethodologyThe methodology', 'three major phases'), 'follow') (('Plot', 'between 1'), 'show') (('Grid search optimization', 'approaches'), 'carry') (('Each', 'forecast so rolling scenario'), 'complement') (('Sales spikes', 'short term'), 'explain') (('exponentially we', 'back time'), 'be') (('Train test split method', 'test 52 weeks data'), 'use') (('term long forecasting', 'forecast'), 'carry') (('forecasts', 'Na\u00efve methods'), 'be') (('model', 'default reliable configurations'), 'facilitate') (('Forecasting', 'weekly scale'), 'carry') (('Components', 'LSTM'), 'require') (('However key improvements', 'problem'), 'expect') (('Pearson coefficient', 'autocorrelation'), 'use') (('stores', 'time series actual y.'), 'label') (('performance Key indicator', 'approaches'), 'be') (('Feature engineering cleaning', 'confidentiality issues'), 'ommite') (('trend long term', 'series'), 'increase') (('best result', '0 0 0'), 'be') (('Hyperparameters', 'model'), 'be') (('info Also messages', 'same reason'), 'supresse') (('changepoints', 'data'), 'fit') (('outliers historical trend', 'known holidays'), 'be') (('stationarity Then autocorrelation', 'forecasting methods'), 'analyze') (('Prophet', 'that'), 'let') (('practice bad presented code', 'notebook'), 'supresse') (('Finally data', 'time then weekly series'), 'rescale') (('Rolling forecasting', '5 methods'), 'carry') (('m th term', 'time'), 'th') (('then it', 'differencing'), 'be') (('which', 'other variables'), 'be') (('model', 'iteration'), 'perform') (('1 ACF', 'else 0'), 'p') (('m', 'typically high lag'), 'be') (('residuals', 'predictability'), 'imply') (('actual optimization', 'values'), 'NOTE') (('series Typically time data', 'four different components'), 'embodie') (('tasks namely computational pandas', 'LSTM'), 'use') (('where first one', 'ds'), 'fit') (('forecast', 'previous seasonal cycles'), 'set') (('5 past observations', 'other cases'), 'use') (('forecasts', 'historical data'), 'be') (('Trends', '30d rolling means'), 'explore') (('LSTM three different architectures', 'research'), 'use') (('specific we', 'Na\u00efve Seasonal basic Na\u00efve'), 'benchmark') (('they', 'moments'), 'be') (('Dickey Fuller ADF quadratic constant trendAugmented test', 'data'), 'be') (('Forecasting results', 'two approaches short term'), 'validate') (('Sales', 'atmospheric pressure'), 'affect') (('lag actual SARIMAX', 'multivariate time series thus forecasting'), 'provide') (('method', 'best configuration'), 'compute') (('output', 'autocorrelation correlation'), 'determine') (('time transformed series', 'time original series'), 'be') (('m', 'yearly seasonal cycle'), 'suggest') (('useful tool', 'autocorrelation'), 'be') (('linear correlation', 'correlation'), 'use') (('that', 'seasonality effects'), 'be') (('It', 'Dickey Fuller Kwiatkowski Phillips Schmidt Shin KPSS Augmented ADF test'), 'determine') (('Grid search', 'ARIMA model'), 'use') (('Baseline accuracy', 'term Average long ones'), 'calculate') (('Time series', 'time series forecastingThere many different forecasting'), 'be') (('1 ACF', 'lag S else Q'), 'q') (('series', 'noise time series so called white random data'), 'produce') (('First one implements', 'historical data'), 'call') (('what', 'mean equals'), 'increase') (('Vanilla LSTM', 'output prediction'), 'make') (('Analysis', 'rolling sales 365 30 day rolling standard data'), 'show') (('Seasonality analysisThe seasonality patterns', 'boxplots'), 'explore') (('forecasting Three methods', 'Prophet'), 'test') (('Finally discussion', 'data analysis'), 'bring') (('Function seasonal_decompose', 'time series'), 'use') (('Each', 'pharmaceutical products'), 'summarize') (('Long Short Term namely Facebook neural networks', 'forecasting three methods'), 'ARIMA') (('final datasets', 'notebook'), 'use') (('Choosing', 'initial p parameters'), 'use') (('which', 'timesteps'), 'base') (('P Value', 'ADF test'), 'be') (('Number', 'input sequences'), 'be') (('Two different approaches', 'problem scoping'), 'adopt') (('LSTM Three architectures', 'LSTM LSTM'), 'test') (('data', 'such mean median sum'), 'split') (('Hyper parameters', 'ACF PACF plot manually analysis'), 'optimize') (('Optimal sets', 'then also rolling forecasts'), 'use') (('This', 'decomposed data'), 'be') (('easy way', 'time larger scales'), 'be') (('sales', 'more outliers'), 'have') (('which', 'overall results'), 'store') (('Three different models', 'Long Short Term Memory network term LSTM artificial neural long forecast'), 'test') (('seasonality', 'Fourier components'), 'compose') (('Auto ARIMA ARIMA', 'term sales short forecasting'), 'method') (('study', 'residuals'), 'be') (('KPSS', 'trend stationarity'), 'use') (('then combination', 'least MSE'), 'apply') (('that', 'X1'), 'be') (('model', 'strategic nature'), 'use') (('Thus following analysis', 'normal Gaussian distribution'), 'be') (('Sample Approximate methods', 'time series'), 'use') (('proportion', 'also rolling means'), 'illustrate') (('then series', 'differencing'), 'rule') (('Stationarity analysisStationarity', 'variance mean autocorrelation'), 'be') (('Confidence intervals', 'cone'), 'draw') (('LSTM', 'term only long forecasting'), 'apply') (('Chart', 'interest'), 'show') (('Stacked LSTM', 'another'), 'be') (('SARIMA Seasonal ARIMA method', 'Auto ARIMA implementation'), 'test') (('backgroundTime Theoretical series', 'observations'), 'be') (('that', 'hidden layers'), 'network') (('Model', 'past'), 'use') (('Prophet model', 'parameters growth'), 'tune') (('National holidays', 'daily sales'), 'expect') (('approach', 'historical data'), 'relate') (('Decomposition', 'randomness typically analysis'), 'be') (('Robert Nau Statistical Forecasting Method', 'SARIMA SARIMAX Python Seasonal ARIMA implementation'), 'improve') (('0 series', 'time'), 'D') (('AIC', 'p'), 'be') (('which', 'products'), 'do') (('Prophet model', 'noted growth'), 'tune') (('Prophet model', 'term only long forecasts'), 'carry') (('which', 'seasonal series'), 'build') (('Kwiatkowski Phillips Schmidt Shin KPSS test', 'N02BE R03'), 'find') (('It', 'visually rolling statistics rolling means'), 'determine') (('conclude', 'pharmacy'), 'guide') (('results comparable pseudo random generators', 'fixed values'), 'set') (('Research work', 'different statistical features'), 'consider') (('Absolute Percentage Error Mean MAPE', 'scenarios'), 'measure') (('preparation Feature engineering Initial dataset', 'quantity'), 'consist') (('Forecasting', 'LSTM three configurations'), 'do') (('Long term', 'Bidirectional LSTM'), 'forecasting') (('also additional parameters', 'ARIMA SARIMA'), 'consider') (('process', 'ARIMA model'), 'make') (('Autocorrelation plots', 'confidence'), 'summarize') (('SES also improved which', 'trends'), 'be') (('ACF', 'indicated q.'), 'be') (('52 rows', 'testing'), 'split') (('term forecasts Long validation', 'actual observations'), 'base') (('data preparation process', 'sequencing time series'), 'include') (('it', 'general larger scale'), 'fail') (('instead Prophet', 'them'), 'use') (('they', 'term long forecasting'), 'consider') (('One series', 'trend stationary underlying series'), 'consider') (('arima Finally pyramid package', 'Auto ARIMA method'), 'instal') (('Average Seasonal models', 'often benchmark models'), 'be') (('entropy values', 'M01AE M01AB'), 'be') (('yearly seasonal component', 'important holidays'), 'be') (('Image', 'categories'), 'show') (('Finally it', 'observations lagged MA'), 'use') (('Next actual implementation', 'products sales data pharmaceutical analysis'), 'present') (('Seasonality', 'R03 R06'), 'confirm') (('Data distribution analysisChart', 'interest'), 'show') (('249', 'maximum confidence'), 'be') (('which', 'time normalization'), 'xt') (('First short theoretical background', 'case study'), 'provide') (('Time series data', '6 years'), 'collect') (('then Average', 'forecast'), 'use') (('Simple Exponential Smoothing where forecasts', '1 ot'), 'be') (('R03 series', 'annual seasonality'), 'find') (('Autocorrelation plots', 'time prior steps'), 'summarize') (('intermediary series', 'anomalies'), 'use') (('Function split_sequence', 'account'), 'provide') (('floor value minimum data', 'predictions'), 'reach') (('other illustrations', 'larger scale'), 'supprese') (('Seasonal decomposition', 'such STL'), 'use') (('plot', 'lag'), 'call') (('that', 'one model'), 'assume') (('analyses', 'investment forecasting business planning'), 'guide') (('correlation values', 'outside code'), 'set') (('analyses', 'distributor pharmacy single chain'), 'make') (('paper', '4 main parts'), 'structure') (('Long term', 'ARIMA model'), 'forecasting') (('Sales spikes', 'state pensions payoff'), 'be') (('1 series', 'time'), 'd') (('data First annual weekly analysis', 'sales strategies'), 'do') (('randomness Vanilla LSTM simpler 10 past observations', 'forecasting better accuracy'), 'produce') (('s', 'pseudo random generators'), 'be') (('that raw observations', 'times'), 'be') (('we', 'smaller scale'), 'related') (('subject', 'drug actual instead individual drugs'), 'make') (('changepoint_range', 'performance'), 'have') (('Also outliers', 'several methods'), 'detect') (('methods', 'N02BE outperform reference Seasonal Naive forecasts'), 'benchmark') (('The higher entropies', 'time more difficult series'), 'be') (('that', 'window rolling means'), 'relate') ", "extra": "['biopsy of the greater curvature', 'disease', 'test']", "label": "Perfect_files", "potential_description_queries": ["account", "accuracy", "aggregate", "airway", "approach", "architecture", "autocorrelation", "average", "background", "baseline", "basic", "benchmark", "best", "calculate", "case", "chain", "character", "check", "classification", "cleaning", "close", "code", "coefficient", "confidence", "consider", "correlation", "correlations", "could", "covariance", "ct", "curve", "cycle", "data", "dataframe", "dataset", "date", "day", "decision", "decomposition", "default", "define", "degree", "dependent", "description", "detail", "detected", "difference", "differencing", "dimension", "distribution", "domain", "effect", "enable", "engineering", "entropy", "environment", "equal", "error", "even", "every", "expected", "explained", "extension", "extent", "factor", "fashion", "feature", "final", "fit", "fitting", "fixed", "floor", "fold", "following", "forecast", "forecasting", "form", "forward", "found", "frequency", "ft", "function", "future", "general", "grid", "group", "growth", "high", "highlight", "human", "image", "implementation", "improve", "including", "increase", "indicate", "individual", "industry", "inflammatory", "info", "input", "interest", "interval", "investment", "key", "labeled", "lag", "latter", "layer", "learning", "least", "let", "level", "linear", "list", "logging", "lower", "main", "major", "market", "matplotlib", "maximum", "mean", "meaning", "measure", "median", "method", "minimum", "missing", "model", "moment", "most", "mutual", "name", "need", "negative", "network", "neural", "new", "next", "no", "noise", "non", "normal", "normalization", "not", "notebook", "null", "number", "numpy", "objective", "observation", "optimization", "optimizer", "order", "out", "output", "overall", "overfitting", "overlap", "package", "parameter", "partial", "past", "pattern", "performance", "period", "pipeline", "plot", "plotting", "point", "positive", "potential", "practice", "prediction", "price", "problem", "property", "purpose", "quadratic", "question", "random", "raw", "reader", "reason", "reference", "regression", "relationship", "research", "residual", "result", "return", "roll", "scale", "scaling", "scenario", "scope", "score", "search", "seasonal", "seasonality", "section", "selected", "sequence", "session", "set", "several", "shape", "short", "similar", "single", "size", "special", "split", "squared", "standard", "state", "stationarity", "strength", "subject", "sum", "summarize", "supervised", "system", "task", "term", "test", "testing", "those", "thumb", "time", "tool", "train", "training", "transformation", "treatment", "trend", "understanding", "unit", "user", "validate", "validation", "value", "variability", "variable", "variance", "vector", "view", "visualization", "visualize", "volume", "walk", "week", "while", "window", "work", "world", "year"], "potential_description_queries_len": 258, "potential_script_queries": ["adfuller", "api", "array", "display", "seaborn", "tensorflow", "tsa"], "potential_script_queries_len": 7, "potential_entities_queries": ["basic", "data", "distribution", "fold", "forecasting", "high", "key", "major", "median", "network", "non", "past", "quadratic", "raw", "search", "seasonality", "single", "standard", "term", "time", "value"], "potential_entities_queries_len": 21, "potential_extra_queries": ["biopsy"], "potential_extra_queries_len": 1, "all_components_potential_queries_len": 265}