{"name": "fork of crc 8 classes tl vgg16 tuning 0 96 a12209 ", "full_name": " h1 just looking at random images h1 idx 1448 h1 just keeping handy a list of the class names tissue cell types h1 80 for train rest for test Did not keep any for validation h1 just looking at random images h3 Data Augmentation h1 9393 h1 batch size 64 h1 serialize weights to HDF5 h1 load weights into new model h1 prepare data for metrics h1 y true np argmax xx for xx in y test h1 cm confusion matrix y pred y hat y true y true h1 fig set size inches np array fig get size inches len subImagesList 100 h1 plt imshow test img cpy h3 Plot precision recall curve h3 Plot Precision Recall curve for each class and iso f1 curves ", "stargazers_count": 0, "forks_count": 0, "description": "0 df image df path. fit_generator train_generator steps_per_epoch STEPS_PER_EPOCHS 1 epochs STEPS_PER_EPOCHS 1 validation_data validation_generator validation_steps STEPS_PER_VAL 1 callbacks callbacks_list t2 time. imshow test_img_cpy plt. listdir katherDir typeList just keeping handy a list of the class names tissue cell types labelList list for dd in os. format batch_size checkpointer ModelCheckpoint weight_path monitor val_loss verbose 1 save_best_only True mode min save_weights_only True reduceLROnPlat ReduceLROnPlateau monitor val_loss factor 0. json w as json_file json_file. 5 s category codedImg np. to_json with open model. save_weights weight_path print Saved model to disk json_file open model. zeros_like image codedImg 0 cat_color 0 codedImg 1 cat_color 1 codedImg 2 cat_color 2 plt. close loaded_model model_from_json loaded_model_json load weights into new modelloaded_model. compile loss categorical_crossentropy optimizer adam metrics acc weight_path 64_104ep_weights. join base_tile_dir. sample 5 name 6C45_CRC Prim HE 02_028. time y_pred_re loaded_model. add_subplot 10 10 n 1 img_to_predict subImagesList n. 3 random_state seed np. show Plot precision_recall_curve Plot Precision Recall curve for each class and iso f1 curvescf weighted avg mean_f1_score cf weighted avg f1 score mean_f1_scoretype labelList labelList This Python 3 environment comes with many helpful analytics libraries installed It is defined by the kaggle python docker image https github. use seaborn dark fig plt. DataFrame path glob os. shape subImagesList dictColor dictColor STROMA 0 0 0 dictColor DEBRIS 0 0 0 dictColor ADIPOSE 0 0 0 dictColor MUCOSA 0 0 0 dictColor EMPTY 0 0 0 dictColor TUMOR 255 0 0 dictColor LYMPHO 0 0 0 dictColor COMPLEX 0 0 0 dictColornp. preprocessing import LabelEncoder read images from files Any results you write to the current directory are saved as output. predict For each class A micro average quantifying score on all classes jointly step_kwargs setup plot details Sensitivity hit rate recall or true positive rate Specificity or true negative rate Precision or positive predictive value Negative predictive value Fall out or false positive rate False negative rate False discovery rate Overall accuracy https www. load_img testLargerFilesDir testLargerFilesList 8 test_img_cpy test_imgtest_img. split _ 1 labelListcustomModel. input colorectal histology mnist kather_texture_2016_larger_images_10 Kather_texture_2016_larger_images_10 testLargerFilesList os. format t2 import timet1 time. load_weights weight_path predict_generator generator teps None max_queue_size 10 workers 1 use_multiprocessing False verbose 0 prepare data for metricsX_test_re X_test 255. iloc _ just looking at random imagesidx np. json r loaded_model_json json_file. shape 0 12 print idx len idx fig ax plt. shape test_img i i 10 j j 10 subImagesList. 3 random_state seed 80 for train rest for test. com data standard deviation formulas. time t1 60print Time used 2. log batch_size 2 aug_epochs int math. split _ 0 df image_name df path. randint len X idx 1448print idx plt. inverse_transform y_val just looking at random imagesidx np. log batch_size 2 print aug_epochs 9393for layer in customModel. argmax xx for xx in y_test t2 time. heatmap cm annot True cbar True fmt d xticklabels True yticklabels True labelList list set y_test_label os. split _ 1 df image_col df path. save_weights weight_path print Saved model to disk model_json customModel. input colorectal histology mnist kather_texture_2016_larger_images_10 Kather_texture_2016_larger_images_10 testLargerFilesDir. listdir testLargerFilesDir testLargerFilesList 8 from keras. reshape WIDTHS HEIGHTS 3 plt. shape 0 print idx plt. image import imagetest_img np. tif df cell_type df path. format t2 batch_size 64STEPS_PER_EPOCHS X_train. format weight_path loaded_model. shapesubImagesList list for i in range 0 w 150 for j in range 0 h 150 print np. com kaggle docker python For example here s several helpful packages to load in from sklearn. format t2 print f1_score weighted 0. predict img_to_predict cat_color dictColor category a. 8 patience 10 verbose 1 mode auto min_delta 0. xlabel y_label idx plt. set_title c_type Data Augmentationimport mathmath. html Standard Deviation of F1 score. input colorectal histology mnist kather_texture_2016_image_tiles_5000 df pd. flow x y None batch_size 32 shuffle True sample_weight None seed None save_to_dir None save_prefix save_format png subset None Test generator 8augs set the vgg16 layers as non trainable train the model on the new data for a few epochs prepare data for metrics https www. fit_generator train_generator steps_per_epoch STEPS_PER_EPOCHS 1 epochs 1 validation_data X_val y_val validation_steps 800 callbacks callbacks_list t2 time. argmax xx for xx in y_pred_re y_true np. trainable Falsefor layer in customModel. argmax y_test idx plt. layers 15 layer. 0001 cooldown 5 min_lr 0. predict img_to_predict print img_pred category labelList img_pred category leLabel. load_weights weight_path print Loaded model from disk. show y_val_label encoder. write model_json serialize weights to HDF5customModel. compile loss categorical_crossentropy optimizer adam metrics acc X_train X_val y_train y_val train_test_split tmp_X_train tmp_y_train train_size 0. get_size_inches len subImagesList 100 plt. time t1 60print Time used with saving aug 2. format BATCH_SIZE checkpointer ModelCheckpoint weight_path monitor loss verbose 1 save_best_only True mode min save_weights_only True reduceLROnPlat ReduceLROnPlateau monitor loss factor 0. 0001 early_stopping EarlyStopping monitor val_loss mode min patience 10 callbacks_list checkpointer early_stopping reduceLROnPlat from keras. html Standard Deviation of F1 score correct when cross check with confusion_matrix correct when cross check with confusion_matrix display false positive images display false negative images test random data from test set main object y_score y_test Plot linewidth. reshape WIDTHS HEIGHTS 3 c_type str img_id y_val_label img_id ax m n. imshow codedImg alpha 0. format t2 show_history history print weight_path customModel. figure figsize 100 100 for n image in enumerate subImagesList 100 a fig. listdir katherDir labelList. format f1_score y_pred y_hat y_true y_true average macro cm confusion_matrix y_pred y_hat y_true y_true plot_confusion_matrix cm target_names target_names sns. format f1_score y_pred y_hat y_true y_true average micro print f1_score macro 0. shape 0 batch_sizeSTEPS_PER_EPOCHSfrom keras. Compute ROC curve and ROC area for each class Compute micro average ROC curve and ROC area Compute macro average ROC curve and ROC area First aggregate all false positive rates Then interpolate all ROC curves at this points Finally average it and compute AUC Plot all ROC curves Plot all ROC curves Zoom Plot all ROC curves Zoom For each class y_score from model. shape subImagesList 0 plt. split _ 1 df cell_type_idx df path. 7 test_size 0. time history customModel. split _Row 0 df image_row df path. Did not keep any for validationseed 1337X_train X_test y_train y_test train_test_split X y_cat train_size 0. org tutorials using_gpu allowing_gpu_memory_growth just looking at random images add the custom layers after the last maxpool layer of vgg16 just looking at random images just looking at random images restnet50 input shape 224. format f1_score y_pred y_hat y_true y_true average weighted print f1_score micro 0. predict X_test_re print X_test. axis off fig. append test_img i i 150 j j 150 print np. 0001 early_stopping EarlyStopping monitor loss mode min patience 10 callbacks_list checkpointer early_stopping reduceLROnPlat import timet1 time. fit_generator train_generator epochs 3 steps_per_epoch 3 t2 time. reshape 1 150 150 3 img_pred np. subplots 3 4 figsize 20 10 print type fig type ax for n in range 4 for m in range 3 class_idx m 4 n img_id idx class_idx ax m n. tif for _ n in enumerate df image_name if n name print df. trainable Trueimport timet1 time. callbacks import ModelCheckpoint LearningRateScheduler EarlyStopping ReduceLROnPlateauweight_path _weights. ", "id": "kasikrit/fork-of-crc-8-classes-tl-vgg16-tuning-0-96-a12209", "size": "9767", "language": "python", "html_url": "https://www.kaggle.com/code/kasikrit/fork-of-crc-8-classes-tl-vgg16-tuning-0-96-a12209", "git_url": "https://www.kaggle.com/code/kasikrit/fork-of-crc-8-classes-tl-vgg16-tuning-0-96-a12209", "script": "Flatten sklearn.metrics keras.preprocessing.image glob LabelBinarizer keras.layers plot_precision_recall_each_class keras.callbacks model_from_json train_test_split VGG16 EarlyStopping Dropout Sequential MaxPool2D Image as pIMG figure Adam itertools {} average_precision_score Layer seaborn numpy show_history auc plot_confusion_matrix matplotlib.pylab array_to_img Input ReduceLROnPlateau PIL img_to_array ModelCheckpoint confusion_matrix f1_score sklearn.model_selection LabelEncoder ImageDataGenerator imread #read images from files image Image load_img sklearn metrics Dense keras.applications.vgg16 keras.utils pandas classification_report tensorflow keras.optimizers keras.applications.resnet50 to_categorical tqdm matplotlib.pyplot BatchNormalization preprocess_input scipy precision_recall_curve interp Model sklearn.preprocessing LearningRateScheduler roc_curve keras.models Convolution2D plot_precision_recall_curve cycle datetime skimage.io ", "entities": "(('histology colorectal mnist', 'pd'), 'input') (('figure', 'enumerate 100'), 'figsize') (('write model_json', 'HDF5customModel'), 'serialize') (('save_weights weight_path print', 'disk json_file open model'), 'Saved') (('you', 'output'), 'read') (('Sensitivity', 'rate recall'), 'predict') (('use_multiprocessing 1 False', 'metricsX_test_re'), 'tep') (('a few epochs', 'metrics https www'), 'flow') (('callbacks', 'ModelCheckpoint LearningRateScheduler EarlyStopping _ ReduceLROnPlateauweight_path weights'), 'import') (('ROC', 'model'), 'curve') (('fmt d labelList True cbar True xticklabels True True list', 'y_test_label os'), 'annot') (('i', 'j 10 j'), 'shape') (('save_weights weight_path print', 'model'), 'Saved') (('format batch_size checkpointer ModelCheckpoint weight_path val_loss', 'mode min True 1 save_best_only True save_weights_only reduceLROnPlat'), 'monitor') (('mode True reduceLROnPlat 1 save_best_only True min save_weights_only ReduceLROnPlateau', 'loss factor'), 'format') (('It', 'python docker image https kaggle github'), 'show') (('maxpool last layer', 'just random images'), 'using_gpu') (('false positive images', 'object main y_score'), 'correct') ", "extra": "['test', 'mucosa']"}