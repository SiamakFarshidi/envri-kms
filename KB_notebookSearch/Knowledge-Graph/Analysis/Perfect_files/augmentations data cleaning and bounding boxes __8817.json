{"name": "augmentations data cleaning and bounding boxes ", "full_name": " h1 Importing Libraries h1 Utilities h1 Reading and Loading the Dataset h1 Range Checking on Bounding Box Coordinates h1 Check if image extensions are all jpg h1 Check if there are corrupted images and all images are 1024 by 1024 h1 Sanity Check between train csv and train images h1 Plotting Multiple Images h1 Plotting Multiples Images with Bounding Boxes h1 Augmentations h1 Bounding Boxes with Albumentations h2 Vertical Flip h2 Horizontal Flip h1 An updated tutorial on Albumentations h2 Image Augmentation for classification ", "stargazers_count": 0, "forks_count": 0, "description": "Great indeed all our images are of 1024x1024 in size. This is a personal preference in actual fact you do not need to do this it is easier for me to normalize the bboxes. ai docs images getting_started augmenting_images augmentation_pipeline_visualized. bboxes is a 2d array. Sanity Check between train csv and train imagesWe will write a function to check if the number of unique image_ids match the number of unique images in the folder. So we won t use the same way here. It controls the probability of applying the augmentation. RandomBrighntessContrast in the example also has one parameter p. com ateplyuk gwd starter efficientdet train Shonenkov s awesome code https www. split train x_min train bbox. AugmentationsAugmentation is an important technique to artifically boost your data size. unique df height. Good seems like all our images in the folder are of. In particular when the dataset is small augmentation prior to training the model will help the network to learn better. And as far as I feel bounding boxes when de normalized should necessary be in integer. It is better to check because if there are a mixture of image type we may face troubles later on. A sneak peek of how a multiple bounding box plot is as such sample https i. jpg train image_id image_id_append_jpg train. astype float32 train train image_id x_min y_min width height train x_max train. unique 1024 to check if all images are of 1024x1024 resolution But we will not be 100 sure if its true in the training folder. We need to be careful here. I have since used Shonenkov s awesome code https www. train bbox train bbox. As we can see from the above there are 49 images without bounding box annotations because they do not have wheats in the image and hence did not appear in the train. However when dealing with multiple classes you should not do this and instead just take the labels from the dataframe accordingly. RandomBrighntessContrast. And from there you can further check which image is the one causing problem. Note that we used our utility function here to plot them. jpg behind all the image_id in the dataframe. The link is here https albumentations. But this is just my opinion. RandomCrop width 256 height 256 A. com albumentations team albumentations_examples tree master notebooks Vertical Flip Horizontal Flip An updated tutorial on AlbumentationsRecently Albumentations updated their website and has more thorough walkthrough on applying their augmentations. astype float32 train height train bbox. This is a serious problem that one can run into when you Normalize the bounding box it may exceed 1 and this will cause an error especially if you decide to augment the images as well. 200012 and when you add that to the width being 150. Below are some snippets of augmentation types you can use interestingly Albumentation offers RandomSunFlare RandomFog and RandomSnow although all the images seem to be taken in a very good lighting but it might not be that bad an idea since in the real world images of wheat may taken in different weather conditions. Plotting Multiples Images with Bounding BoxesIn object detection with bounding boxes it is always a good idea to randomly plot some images with their bounding boxes to check for any awry bounding box coordinates. But there is a caveat here my bounding boxes array is of shape N 5 where the last element is the labels. Importing LibrariesIn this kernel I present some utility functions to do some sanity check on images as well as some functions that you can reuse for future projects when you want to plot multiple images in a grid. Here we see a nice grid of 12 images plotted. ALSO THIS WEBSITE IS AMAZING FOR YOU TO TUNE AND VISUALIZE YOUR AUGMENTATIONS https albumentations demo. This will make us manipulate the data easier later. Next it is better to append. apply lambda x x 2. Let s look at the respective problematic rows. So we still need to do some simple preprocessing below. Let s look at an example transform A. Range Checking on Bounding Box CoordinatesFurthermore due to python s internal floating problems there may be weird values like negative or values that adds up to be more than 1024 in x_max y_max. So the next portion will help to expand them out. But when you want to use Albumentations to plot bounding boxes it takes in bboxes in the format of pascal_voc which is x_min y_min x_max y_max it also takes in label_fields which are the labels for each bounding box. Check if there are corrupted images and all images are 1024 by 1024Most people will use df width. csv and label them as 0. I assign a class 1 which is the label wheat. Let s change these problematic values to 1024We can delete width and height columns because we do not need them it can be easily pulled out from the images itself. HorizontalFlip and A. RandomCrop width 256 height 256 means that A. So you have to round down. A call to Compose will return a transform function that will perform image augmentation. One can tune the parameters accordingly. Check if image extensions are all jpgFirst we check if all images in the train folder are all in. And the good thing is this code also helps us to check for corrupted images as well so if there is a corrupted image it will definitely show up that the counter is non zero. To define an augmentation pipeline you need to create an instance of the Compose class. jpg Now we will use the above context on our wheat example. References Albumentation Documentations https github. 2 In the example Compose receives a list with three augmentations A. And if you are interested in just visualizing one certain image s bounding box plot you can first extract the chosen image s dataframe and convert the bounding box of the image into a 2d array. com Paperspace DataAugmentationForObjectDetection ateplyuk s gwd starter https www. HorizontalFlip in this example has one parameter named p. com shonenkov training efficientdet to make the code above more compact. Step 1 Import the required libraries import cv2 import albumentations as A Step 2 Define an augmentation pipeline. Albumentations A caution here this competition has all labels to be 1 so a neat trick is just to use np. width axis 1 train y_max train. To create an augmentation you create an instance of the required augmentation class and pass augmentation parameters to it. Reading and Loading the DatasetI personally like to expand the bounding box coordinates into the form of x_min y_min x_max y_max but currently they are stored in a list of x_min y_min width of bbox height of bbox. apply lambda x x 1. astype float32 train y_min train bbox. augmentation pipeline https albumentations. RandomCrop will take an input image extract a random patch with size 256 by 256 pixels from it and then pass the result to the next augmentation in the pipeline in this case to A. Bounding Boxes with AlbumentationsRecall we are using our chosen image as example for convenience I will remind you of the chosen images image matrix and its bounding boxes coordinates below. Plotting Multiple ImagesHere we define a nice function that is useful not only for this competition but for similar project as well. apply lambda x x 0. 000015 which exceeds the image size already. The following picture depicts the Compose idea wonderfully. head image_id_list train image_id. Then apply the draw_rect function to plot. 800003 it gives you 1024. It may be useful later on should we wish to add in images with no wheat inside the image. 5 means that with a probability of 50 the transform will flip the image horizontally and with a probability of 50 the transform won t modify the input image. apply lambda col col. p is a special parameter that is supported by almost all augmentations. head randomly choose 12 images to plot randomly choose 12 image. ai docs getting_started image_augmentation. With a probability of 20 this augmentation will change the brightness and contrast of the image received from A. height axis 1 train. tolist image_id_append_jpg for image_id in image_id_list image_id_append_jpg. RandomCrop receives two parameters height and width. RandomBrightnessContrast p 0. The sole reason that for eg row 31785 has x_max more than 1024 is because of the original dataset s labelling. ones to populate the label fields. It might be an idea that we can put these 49 images inside the train. And with a probability of 80 it will keep the received image unchanged. Image Augmentation for classificationThe below are purely for my documentation and learning experience so most of the content are copied verbatim from Albumentation s website https albumentations. astype float32 train width train bbox. For example in row 31785 the x_min provided is 873. com shonenkov training efficientdet UtilitiesUtility functions are stored here they are useful and feel free to add these into your arsenal. png References Paperspace DataAugmentationForObjectDetection https github. apply lambda x x 3. Although I have to say that in this particular competition there are quite a lot of images with many bounding boxes and hence you have to scrutinize clearly. As an argument to the Compose class you need to pass a list of augmentations you want to apply. apply lambda x x 1 1. ", "id": "reighns/augmentations-data-cleaning-and-bounding-boxes", "size": "8817", "language": "python", "html_url": "https://www.kaggle.com/code/reighns/augmentations-data-cleaning-and-bounding-boxes", "git_url": "https://www.kaggle.com/code/reighns/augmentations-data-cleaning-and-bounding-boxes", "script": "albumentations total_image_list IPython.core.interactiveshell plot_random_images collections numpy check_file_type check_image_size ceil plot_multiple_img matplotlib.pyplot sanity_tally tqdm.notebook pandas skip_csv_header Counter draw_rect tqdm InteractiveShell math random_bbox_check draw_rect_with_labels ", "entities": "(('which', 'image size'), '000015') (('1 which', 'class'), 'assign') (('Here we', '12 images'), 'see') (('augmentation', 'A.'), 'change') (('here they', 'arsenal'), 'store') (('de when normalized', 'necessary integer'), 'far') (('further image', 'problem'), 'check') (('bounding box sneak how multiple plot', 'sample https such i.'), 'peek') (('network', 'small prior model'), 'help') (('they', 'hence train'), 'be') (('images', 'train folder'), 'check') (('it', 'easily images'), 'let') (('it', 'box coordinates'), 'object') (('RandomCrop', 'height'), 'receive') (('we', 'training 100 folder'), '1024') (('width', 'that'), '200012') (('I', 'images image chosen matrix'), 'use') (('you', 'dataframe'), 'do') (('definitely counter', 'corrupted images'), 'be') (('transform', 'input image'), 'mean') (('we', 'train'), 'be') (('it', 'received image'), 'keep') (('I', 'code https since awesome www'), 'use') (('you', 'Compose class'), 'define') (('It', 'augmentation'), 'control') (('me', 'bboxes'), 'be') (('indeed images', 'size'), 'be') (('we', 'troubles'), 'be') (('us', 'data'), 'make') (('s', 'respective problematic rows'), 'let') (('1024', 'df width'), 'check') (('that', 'similar project'), 'define') (('ALSO WEBSITE', 'AUGMENTATIONS https albumentations demo'), 'be') (('that', 'image augmentation'), 'return') (('com albumentations team albumentations_examples tree master Vertical Flip Horizontal updated tutorial', 'augmentations'), 'notebook') (('when you', 'grid'), 'import') (('jpg Now we', 'wheat example'), 'use') (('hence you', 'many bounding boxes'), 'have') (('you', 'augmentations'), 'need') (('which', 'bounding box'), 'y_min') (('sole reason', 'original labelling'), 'be') (('especially you', 'images'), 'be') (('So next portion', 'them'), 'help') (('special that', 'almost all augmentations'), 'be') (('head', 'randomly 12 image'), 'choose') (('Compose', 'augmentations three A.'), '2') (('AugmentationsAugmentation', 'data important artifically size'), 'be') (('neat trick', 'just np'), 'caution') (('so most', 'website https verbatim albumentations'), 'be') (('RandomCrop width', '256 height'), 'mean') (('images', 'folder'), 'seem') (('we', 'here them'), 'note') (('currently they', 'bbox'), 'like') (('RandomBrighntessContrast', 'also one parameter'), 'have') (('it', 'weather different conditions'), 'be') (('later we', 'image'), 'wish') (('Step 1 required libraries', 'Step 2 Define'), 'Import') (('RandomCrop', 'A.'), 'take') (('HorizontalFlip', 'one parameter'), 'have') (('N 5 where last element', 'shape'), 'be') (('you', '2d array'), 'extract') (('following picture', 'Compose idea'), 'depict') (('you', 'it'), 'create') (('x_min 31785 provided', 'row'), 'be') (('that', 'x_max'), 'be') (('number', 'folder'), 'write') (('So we', 'still simple preprocessing'), 'need') ", "extra": "['annotation']"}